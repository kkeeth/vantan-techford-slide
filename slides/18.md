---
theme: default
background: https://picsum.photos/1920/1080
class: text-center
highlighter: shiki
lineNumbers: true
info: |
  ## TypeScript + React ãƒãƒ³ã‚ºã‚ªãƒ³è¬›åº§
  ç¬¬18å›ï¼šãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªé–‹ç™ºï¼ˆãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½ç·¨ï¼‰
fonts:
  sans: "Josefin Sans"
  serif: "Noto Sans JP"
  mono: "Fira Code"

drawings:
  persist: false
transition: slide-left
title: TypeScript/React å…¥é–€è¬›ç¾©
---

# TypeScript + React<br>ãƒãƒ³ã‚ºã‚ªãƒ³è¬›åº§

## ç¬¬18å›ï¼šãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªé–‹ç™º<br>ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½ç·¨

<div class="pt-12">
  <span @click="$slidev.nav.next" class="px-2 py-1 rounded cursor-pointer" hover="bg-white bg-opacity-10">
    Press Space for next page <carbon:arrow-right class="inline"/>
  </span>
</div>

<div class="abs-br m-6 flex gap-2">
  <button @click="$slidev.nav.openInEditor()" title="Open in Editor" class="text-xl slidev-icon-btn opacity-50 !border-none !hover:text-white">
    <carbon:edit />
  </button>
</div>

<style>
h1 {
  background-color: #fff;
  background-image: none;
}
</style>

---
layout: section
---

# å‡ºå¸­ç¢ºèªâœ‹ï¸

---
layout: default
---

# æœ¬æ—¥ã®å†…å®¹

<Toc minDepth="2" maxDepth="2" />

<style>
h2 {
  margin: 1rem 0;
}
</style>

## ğŸ‘‰ï¸ TypeScript ã§ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã‚ˆã†ï¼

---
layout: section
---

# ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½ã®å®Ÿè£…

---

# ç›®æ¬¡

## 1. ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã®å¿…è¦æ€§ã¨ Dexie.js ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
## 2. TypeScript ã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
## 3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿æ©Ÿèƒ½
## 4. ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ

â€» ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã¦ã—ã¾ã†å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ï¼Œå¿…è¦ã«ãªã£ãŸæ™‚ç‚¹ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã—ã¾ã™ï¼

<style>
h2 {
  margin-bottom: .5rem;
}
</style>

---

# 1. ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã®å¿…è¦æ€§ã¨ Dexie.js ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

## 1.1 ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã¦ã—ã¾ã†å•é¡Œ

<div grid="~ cols-2 gap-4">
<div>

```tsx
// ç¾åœ¨ã®çŠ¶æ³ï¼šãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ¶ˆãˆã‚‹
const App = () => {
  const [messages, setMessages] = useState<Message[]>([]);

  // ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã« messages ã¯ç©ºé…åˆ—ã«æˆ»ã‚‹
  // â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ•ç¨¿ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå…¨ã¦æ¶ˆå¤±

  // ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãŒå¿…è¦ï¼
};
```

</div>
<div>

**ç¾åœ¨ã®å•é¡Œç‚¹**
- ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå…¨ã¦æ¶ˆãˆã‚‹
- ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ãŒå¤±ã‚ã‚Œã‚‹
- å®Ÿç”¨çš„ãªã‚¢ãƒ—ãƒªã«ã™ã‚‹ãŸã‚ã«ã¯æ°¸ç¶šåŒ–ãŒå¿…è¦

**è§£æ±ºç­–ï¼šDexie.js**
- ãƒ–ãƒ©ã‚¦ã‚¶ã® IndexedDB ã‚’ç°¡å˜ã«ä½¿ãˆã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- TypeScript å®Œå…¨å¯¾å¿œ
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚å‹•ä½œ

</div>
</div>

---

## 1.2 Dexie.js ãŒå¿…è¦ã«ãªã£ãŸã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

<div grid="~ cols-2 gap-4">
<div>

```bash
# ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install dexie

# TypeScript ã®å‹å®šç¾©ã‚‚ä¸€ç·’ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹
```

</div>
<div>

**Dexie.js ã®ç‰¹å¾´**
- IndexedDB ã®ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- è¤‡é›‘ãª IndexedDB API ã‚’ç°¡å˜ã«ä½¿ç”¨å¯èƒ½
- TypeScript ã§ã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ãŒå¯èƒ½
- Promise ãƒ™ãƒ¼ã‚¹ã® API
- React ã¨ã®ç›¸æ€§ãŒè‰¯ã„

</div>
</div>

---

## 1.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆãŒå¿…è¦ã«ãªã£ãŸã®ã§è¿½åŠ 

<div grid="~ cols-2 gap-4">
<div>

```tsx
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ãŒå¿…è¦ã«ãªã£ãŸã®ã§è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
// src/db.ts
import Dexie, { Table } from 'dexie';
import type { Message } from './types';

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©
export class ChatDatabase extends Dexie {
  // ãƒ†ãƒ¼ãƒ–ãƒ«ã®å‹å®šç¾©
  messages!: Table<Message>;

  constructor() {
    super('ChatDatabase');

    // ã‚¹ã‚­ãƒ¼ãƒã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
    this.version(1).stores({
      messages: '++id, text, date, image'
    });
  }
}

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
export const db = new ChatDatabase();
```

</div>
<div>

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šã®ãƒã‚¤ãƒ³ãƒˆ**
- `Dexie` ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ä½œæˆ
- `Table<Message>` ã§å‹å®‰å…¨ãªãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
- `++id` ã§è‡ªå‹•ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆä¸»ã‚­ãƒ¼
- `version(1)` ã§ã‚¹ã‚­ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
- TypeScript ã®æ©æµã§å‹å®‰å…¨ãªDBæ“ä½œ

</div>
</div>

---

# 2. TypeScript ã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

## 2.1 Message å‹ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ID ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒå‡ºã¦ããŸ

<div grid="~ cols-2 gap-4">
<div>

```tsx
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½¿ç”¨ã«ä¼´ã„ Message å‹ã‚’æ›´æ–°
// src/types.ts
export type Message = {
  id?: number; // Dexie ãŒè‡ªå‹•ç”Ÿæˆã™ã‚‹ã®ã§ optional
  text: string;
  date: string;
  image?: string;
  createdAt?: Date; // æ¤œç´¢ãƒ»ã‚½ãƒ¼ãƒˆç”¨ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚‚è¿½åŠ 
};
```

</div>
<div>

**å‹å®šç¾©ã®æ›´æ–°ç†ç”±**
- `id?` ã§ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã«å¤‰æ›´ï¼ˆDexie ãŒè‡ªå‹•ç”Ÿæˆï¼‰
- `createdAt?` ã§ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¿½åŠ 
- æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®äº’æ›æ€§ã‚’ä¿æŒ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã«é©ã—ãŸå‹æ§‹é€ 

</div>
</div>

---

## 2.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œé–¢æ•°ãŒå¿…è¦ã«ãªã£ãŸã®ã§è¿½åŠ 

<div grid="~ cols-2 gap-4">
<div>

```tsx
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œãŒå¿…è¦ã«ãªã£ãŸã®ã§é–¢æ•°ã‚’ä½œæˆ
// src/db.ts ã«è¿½åŠ 

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜
export const saveMessage = async (message: Omit<Message, 'id'>): Promise<number> => {
  const messageWithTimestamp = {
    ...message,
    createdAt: new Date(),
  };

  return await db.messages.add(messageWithTimestamp);
};

// å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—ï¼ˆæ–°ã—ã„é †ï¼‰
export const getAllMessages = async (): Promise<Message[]> => {
  return await db.messages
    .orderBy('createdAt')
    .reverse()
    .toArray();
};

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
export const deleteMessage = async (id: number): Promise<void> => {
  await db.messages.delete(id);
};
```

</div>
<div>

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œé–¢æ•°ã®ãƒã‚¤ãƒ³ãƒˆ**
- `Omit<Message, 'id'>` ã§ ID ã‚’é™¤å¤–ã—ãŸå‹
- `async/await` ã§éåŒæœŸå‡¦ç†ã‚’å‹å®‰å…¨ã«
- `orderBy('createdAt').reverse()` ã§æ–°ã—ã„é †ã«ã‚½ãƒ¼ãƒˆ
- å„é–¢æ•°ã®æˆ»ã‚Šå€¤å‹ã‚’æ˜ç¤º
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯å‘¼ã³å‡ºã—å´ã§å®Ÿè£…

</div>
</div>

---

# 3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿æ©Ÿèƒ½

## 3.1 æŠ•ç¨¿å‡¦ç†ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¯¾å¿œã«æ›´æ–°

<div grid="~ cols-2 gap-4">
<div>

```tsx
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜ãŒå¿…è¦ã«ãªã£ãŸã®ã§ import ã‚’è¿½åŠ 
import { saveMessage, getAllMessages, deleteMessage } from './db';

const App = () => {
  const [text, setText] = useState<string>('');
  const [messages, setMessages] = useState<Message[]>([]);
  const [isPosting, setIsPosting] = useState<boolean>(false);
  const [image, setImage] = useState<File | null>(null);

  // æŠ•ç¨¿å‡¦ç†ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¯¾å¿œã«æ›´æ–°
  const handlePost = async (e: FormEvent) => {
    e.preventDefault();

    const error = validateMessage(text);
    if (error) {
      alert(error);
      return;
    }

    setIsPosting(true);

    try {
      const newMessage = {
        text: text.trim(),
        date: new Date().toLocaleString(),
      };
```

</div>
<div>

```tsx
      if (image) {
        const reader = new FileReader();
        reader.onload = async () => {
          const messageWithImage = {
            ...newMessage,
            image: reader.result as string,
          };

          // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
          await saveMessage(messageWithImage);
          // ç”»é¢ã‚’æ›´æ–°
          await loadMessages();
        };
        reader.readAsDataURL(image);
      } else {
        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
        await saveMessage(newMessage);
        // ç”»é¢ã‚’æ›´æ–°
        await loadMessages();
      }

      setText('');
      setImage(null);
    } catch (error) {
      console.error('æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼:', error);
      alert('æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    } finally {
      setIsPosting(false);
    }
  };
```

</div>
</div>

<div grid="~ cols-2 gap-4">
<div>

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¯¾å¿œã®ãƒã‚¤ãƒ³ãƒˆ**
- `saveMessage()` ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ°¸ç¶šåŒ–
- `loadMessages()` ã§æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ DB ã‚¨ãƒ©ãƒ¼ã«å¯¾å¿œ
- éåŒæœŸå‡¦ç†ã®å‹å®‰å…¨æ€§ã‚’ä¿æŒ

</div>
</div>

---

## 3.2 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èª­ã¿è¾¼ã¿é–¢æ•°ã®å®Ÿè£…

<div grid="~ cols-2 gap-4">
<div>

```tsx
// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èª­ã¿è¾¼ã¿ãŒå¿…è¦ã«ãªã£ãŸã®ã§é–¢æ•°ã‚’è¿½åŠ 
const loadMessages = async (): Promise<void> => {
  try {
    const allMessages = await getAllMessages();
    setMessages(allMessages);
  } catch (error) {
    console.error('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    // ã‚¨ãƒ©ãƒ¼æ™‚ã¯æ—¢å­˜ã® state ã‚’ä¿æŒ
  }
};

// å‰Šé™¤å‡¦ç†ã‚‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¯¾å¿œã«æ›´æ–°
const handleDeleteMessage = async (messageId: number): Promise<void> => {
  if (!messageId) {
    console.warn('Invalid message ID');
    return;
  }

  const targetMessage = messages.find(m => m.id === messageId);
  if (!targetMessage) {
    console.warn(`Message with id ${messageId} not found`);
    return;
  }
```

</div>
<div>

```tsx
  const previewText = targetMessage.text.length > 20
    ? `${targetMessage.text.substring(0, 20)}...`
    : targetMessage.text;

  if (window.confirm(`ã€Œ${previewText}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
    try {
      // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å‰Šé™¤
      await deleteMessage(messageId);
      // ç”»é¢ã‚’æ›´æ–°
      await loadMessages();
    } catch (error) {
      console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
      alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  }
};
```

</div>
</div>

<div grid="~ cols-2 gap-4">
<div>

**èª­ã¿è¾¼ã¿ãƒ»å‰Šé™¤å‡¦ç†ã®ãƒã‚¤ãƒ³ãƒˆ**
- `loadMessages()` ã§ DB ã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
- ã‚¨ãƒ©ãƒ¼æ™‚ã¯æ—¢å­˜ã® state ã‚’ä¿æŒ
- å‰Šé™¤æ™‚ã‚‚DBã¨ç”»é¢ã®ä¸¡æ–¹ã‚’æ›´æ–°
- TypeScript ã§å‹å®‰å…¨ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

</div>
</div>

---

# 4. ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ

## 4.1 åˆå›èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã™ã‚‹æ©Ÿèƒ½ãŒå¿…è¦ã«ãªã£ãŸ

<div grid="~ cols-2 gap-4">
<div>

```tsx
// ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®ãƒ‡ãƒ¼ã‚¿å¾©å…ƒãŒå¿…è¦ã«ãªã£ãŸã®ã§ useEffect ã‚’è¿½åŠ 
import { useEffect } from 'react';

const App = () => {
  const [text, setText] = useState<string>('');
  const [messages, setMessages] = useState<Message[]>([]);
  const [isPosting, setIsPosting] = useState<boolean>(false);
  const [isLoading, setIsLoading] = useState<boolean>(true); // èª­ã¿è¾¼ã¿çŠ¶æ…‹ã‚’è¿½åŠ 

  // ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
  useEffect(() => {
    const initializeApp = async () => {
      try {
        await loadMessages();
      } catch (error) {
        console.error('ã‚¢ãƒ—ãƒªåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
        // ã‚¨ãƒ©ãƒ¼ã§ã‚‚ã‚¢ãƒ—ãƒªã¯ä½¿ç”¨å¯èƒ½ã«ã™ã‚‹
      } finally {
        setIsLoading(false);
      }
    };

    initializeApp();
  }, []); // ç©ºã®ä¾å­˜é…åˆ—ã§åˆå›ã®ã¿å®Ÿè¡Œ
```

</div>
<div>

```tsx
  // èª­ã¿è¾¼ã¿ä¸­ã®è¡¨ç¤º
  if (isLoading) {
    return (
      <Box
        sx={{
          display: 'flex',
          justifyContent: 'center',
          alignItems: 'center',
          height: '100vh',
        }}
      >
        <Typography variant="h6" color="text.secondary">
          ğŸ’¬ ãƒãƒ£ãƒƒãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...
        </Typography>
      </Box>
    );
  }

  return (
    // æ—¢å­˜ã® JSX
  );
};
```

</div>
</div>

<div grid="~ cols-2 gap-4">
<div>

**åˆæœŸåŒ–å‡¦ç†ã®ãƒã‚¤ãƒ³ãƒˆ**
- `useEffect` ã§ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
- `isLoading` çŠ¶æ…‹ã§èª­ã¿è¾¼ã¿ä¸­ã‚’è¡¨ç¤º
- ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ã‚¢ãƒ—ãƒªã¯ä½¿ç”¨å¯èƒ½
- ç©ºã®ä¾å­˜é…åˆ—ã§åˆå›ã®ã¿å®Ÿè¡Œ

</div>
</div>

---

## 4.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–

<div grid="~ cols-2 gap-4">
<div>

```tsx
// ã‚ˆã‚Šå …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå¿…è¦ã«ãªã£ãŸã®ã§å¼·åŒ–
const loadMessages = async (): Promise<void> => {
  try {
    const allMessages = await getAllMessages();
    setMessages(allMessages);
  } catch (error) {
    console.error('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);

    // IndexedDB ãŒä½¿ç”¨ã§ããªã„å ´åˆã®å¯¾å‡¦
    if (error instanceof Error && error.message.includes('IndexedDB')) {
      console.warn('IndexedDB ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ãƒ¡ãƒ¢ãƒªä¸Šã§ã®ã¿å‹•ä½œã—ã¾ã™ã€‚');
    }

    // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ç©ºé…åˆ—ã§åˆæœŸåŒ–ï¼ˆã‚¢ãƒ—ãƒªã¯å‹•ä½œå¯èƒ½ï¼‰
    setMessages([]);
  }
};
```

</div>
<div>

```tsx
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã®æ±ç”¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©
const handleDatabaseError = (operation: string, error: unknown): void => {
  console.error(`${operation}ã‚¨ãƒ©ãƒ¼:`, error);

  if (error instanceof Error) {
    // ç‰¹å®šã®ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸå‡¦ç†
    if (error.message.includes('QuotaExceededError')) {
      alert('ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚å¤ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚');
    } else if (error.message.includes('NotFoundError')) {
      alert('ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
    } else {
      alert(`æ“ä½œã«å¤±æ•—ã—ã¾ã—ãŸï¼š${error.message}`);
    }
  } else {
    alert('ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
  }
};
```

</div>
</div>

<div grid="~ cols-2 gap-4">
<div>

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–**
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å›ºæœ‰ã‚¨ãƒ©ãƒ¼ã®è­˜åˆ¥
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ä¸è¶³ã®å¯¾å¿œ
- ã‚¨ãƒ©ãƒ¼æ™‚ã§ã‚‚ã‚¢ãƒ—ãƒªå‹•ä½œã‚’ç¶™ç¶š
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

</div>
</div>

---

# 5. å®Œæˆã¨å‹•ä½œç¢ºèª

## 5.1 ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½ã®æœ€çµ‚ç¢ºèª

<div grid="~ cols-2 gap-4">
<div>

```tsx
// æœ€çµ‚çš„ãªã‚¢ãƒ—ãƒªã®æ§‹æˆ
const App = () => {
  // çŠ¶æ…‹ç®¡ç†
  const [text, setText] = useState<string>('');
  const [messages, setMessages] = useState<Message[]>([]);
  const [isPosting, setIsPosting] = useState<boolean>(false);
  const [isLoading, setIsLoading] = useState<boolean>(true);
  const [image, setImage] = useState<File | null>(null);

  // åˆæœŸåŒ–å‡¦ç†
  useEffect(() => {
    const initializeApp = async () => {
      try {
        await loadMessages();
      } finally {
        setIsLoading(false);
      }
    };
    initializeApp();
  }, []);

  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œé–¢æ•°
  const loadMessages = async (): Promise<void> => {
    // å®Ÿè£…æ¸ˆã¿
  };

  const handlePost = async (e: FormEvent) => {
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¯¾å¿œå®Ÿè£…æ¸ˆã¿
  };

  const handleDeleteMessage = async (messageId: number): Promise<void> => {
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¯¾å¿œå®Ÿè£…æ¸ˆã¿
  };

  return (
    // JSXå®Ÿè£…æ¸ˆã¿
  );
};
```

</div>
<div>

**æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**

âœ… ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ°¸ç¶šåŒ–ä¿å­˜
âœ… ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
âœ… ç”»åƒä»˜ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¿å­˜
âœ… ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‰Šé™¤
âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
âœ… èª­ã¿è¾¼ã¿çŠ¶æ…‹ã®è¡¨ç¤º
âœ… TypeScript å‹å®‰å…¨æ€§
âœ… ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ

**ç¢ºèªæ–¹æ³•**
1. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿
2. ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå¾©å…ƒã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

</div>
</div>

---

## 5.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†

<div grid="~ cols-2 gap-4">
<div>

```tsx
// ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ã®ç›£è¦–ãŒå¿…è¦ã«ãªã£ãŸã‚‰è¿½åŠ 
// src/db.ts ã«è¿½åŠ 

// ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ã‚’å–å¾—
export const getStorageInfo = async () => {
  try {
    const messageCount = await db.messages.count();
    const totalSize = await db.messages.toArray().then(messages => {
      return messages.reduce((total, message) => {
        const textSize = new Blob([message.text]).size;
        const imageSize = message.image ? new Blob([message.image]).size : 0;
        return total + textSize + imageSize;
      }, 0);
    });

    return {
      messageCount,
      totalSize: Math.round(totalSize / 1024), // KBå˜ä½
    };
  } catch (error) {
    console.error('ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
    return { messageCount: 0, totalSize: 0 };
  }
};
```

</div>
<div>

```tsx
// å¤ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤ï¼ˆå®¹é‡ç®¡ç†ï¼‰
export const cleanupOldMessages = async (keepCount: number = 100) => {
  try {
    const allMessages = await db.messages.orderBy('createdAt').reverse().toArray();
    if (allMessages.length > keepCount) {
      const messagesToDelete = allMessages.slice(keepCount);
      const idsToDelete = messagesToDelete.map(m => m.id!);
      await db.messages.bulkDelete(idsToDelete);
    }
  } catch (error) {
    console.error('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', error);
  }
};
```

</div>
</div>

<div grid="~ cols-2 gap-4">
<div>

**ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†ã®ãƒã‚¤ãƒ³ãƒˆ**
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ã¨ä½¿ç”¨å®¹é‡ã®ç›£è¦–
- è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ©Ÿèƒ½
- `bulkDelete` ã§åŠ¹ç‡çš„ãªä¸€æ‹¬å‰Šé™¤
- ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚å‹•ä½œç¶™ç¶š

**é‹ç”¨ã§ã®è€ƒæ…®äº‹é …**
- å®šæœŸçš„ãªå¤ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤
- ç”»åƒã‚µã‚¤ã‚ºã®åˆ¶é™
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡é€šçŸ¥
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½

</div>
</div>

---

# 6. æ¬¡å›ã®äºˆå‘Š

## 6.1 æ¬¡å›ã®å†…å®¹ï¼ˆç¬¬19å›ï¼‰

æ¬¡å›ã¯ TypeScript ã§ã‚¢ãƒ—ãƒªã®ä»•ä¸Šã’ã¨æ©Ÿèƒ½æ‹¡å¼µã‚’è¡Œã„ã¾ã™ï¼š

- è¨­å®šç”»é¢ã®è¿½åŠ ï¼ˆãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç­‰ï¼‰
- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- TypeScript ã§ã® React.memo æ´»ç”¨
- ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å‘ã‘ã®æœ€çµ‚èª¿æ•´

<v-click>

## 6.2 ä»Šæ—¥ã®å®¿é¡Œ ğŸ“š

1. ä»Šæ—¥å®Ÿè£…ã—ãŸãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½ã‚’ã„ã‚ã„ã‚è©¦ã—ã¦ã¿ã‚‹
2. Dexie.js ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§ã¿ã‚‹
3. IndexedDB ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ã‚‹
4. TypeScript ã§ã®éåŒæœŸå‡¦ç†ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¾©ç¿’ã™ã‚‹

</v-click>

---
layout: section
---

# ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ ğŸ‰

## æ¬¡å›ã¯ã‚¢ãƒ—ãƒªã®ä»•ä¸Šã’ã‚’è¡Œã„ã¾ã™ï¼