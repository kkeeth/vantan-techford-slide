---
theme: default
background: https://picsum.photos/1920/1080
class: text-center
highlighter: shiki
lineNumbers: false
info: |
  ## TypeScript + React ãƒãƒ³ã‚ºã‚ªãƒ³è¬›åº§
  ç¬¬18å›ï¼šãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªé–‹ç™ºï¼ˆãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½ç·¨ï¼‰
fonts:
  sans: "Josefin Sans"
  serif: "Noto Sans JP"
  mono: "Fira Code"

drawings:
  persist: false
transition: slide-left
title: TypeScript/React å…¥é–€è¬›ç¾©
---

# TypeScript + React<br>ãƒãƒ³ã‚ºã‚ªãƒ³è¬›åº§

## ç¬¬18å›ï¼šãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªé–‹ç™º<br>ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½ç·¨

<div class="pt-12">
  <span @click="$slidev.nav.next" class="px-2 py-1 rounded cursor-pointer" hover="bg-white bg-opacity-10">
    Press Space for next page <carbon:arrow-right class="inline"/>
  </span>
</div>

<div class="abs-br m-6 flex gap-2">
  <button @click="$slidev.nav.openInEditor()" title="Open in Editor" class="text-xl slidev-icon-btn opacity-50 !border-none !hover:text-white">
    <carbon:edit />
  </button>
</div>

<style>
  h1 {
    color: #fff;
  }
</style>

---
layout: section
---

# å‡ºå¸­ç¢ºèªâœ‹ï¸

---
layout: default
---

# æœ¬æ—¥ã®å†…å®¹

<Toc minDepth="2" maxDepth="2" />

<style>
h2 {
  margin: 1rem 0;
}
</style>

## ğŸ‘‰ï¸ TypeScript ã§ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã‚ˆã†ï¼

---
layout: section
---

# ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½ã®å®Ÿè£…

---

# ç›®æ¬¡

## 1. Dexie.js ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
## 2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿æ©Ÿèƒ½
## 3. ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ

<style>
h2 {
  margin-bottom: .5rem;
}
</style>

---

# 1. Dexie.js ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

## 1.1 ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã¦ã—ã¾ã†å•é¡Œ

<div grid="~ cols-2 gap-4">
<div>

```tsx
// ç¾åœ¨ã®çŠ¶æ³ï¼šãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ¶ˆãˆã‚‹
const App = () => {
  const [messages, setMessages] = useState<Message[]>([]);

  // ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã« messages ã¯ç©ºé…åˆ—ã«æˆ»ã‚‹
  // â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ•ç¨¿ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå…¨ã¦æ¶ˆå¤±

  // ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãŒå¿…è¦ï¼
};
```

</div>
<div>

**ç¾åœ¨ã®å•é¡Œç‚¹**
- ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå…¨ã¦æ¶ˆãˆã‚‹
- ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ãŒå¤±ã‚ã‚Œã‚‹
- å®Ÿç”¨çš„ãªã‚¢ãƒ—ãƒªã«ã™ã‚‹ãŸã‚ã«ã¯æ°¸ç¶šåŒ–ãŒå¿…è¦

**è§£æ±ºç­–ï¼šDexie.js**
- ãƒ–ãƒ©ã‚¦ã‚¶ã® IndexedDB ã‚’ç°¡å˜ã«ä½¿ãˆã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- TypeScript å®Œå…¨å¯¾å¿œ
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚å‹•ä½œ

</div>
</div>

---

## 1.2 Dexie.js ãŒå¿…è¦ã«ãªã£ãŸã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

<div grid="~ cols-2 gap-4">
<div>

```bash
# ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install dexie

# TypeScript ã®å‹å®šç¾©ã‚‚ä¸€ç·’ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹
```

</div>
<div>

**Dexie.js ã®ç‰¹å¾´**
- IndexedDB ã®ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- è¤‡é›‘ãª IndexedDB API ã‚’ç°¡å˜ã«ä½¿ç”¨å¯èƒ½
- TypeScript ã§ã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ãŒå¯èƒ½
- Promise ãƒ™ãƒ¼ã‚¹ã® API
- React ã¨ã®ç›¸æ€§ãŒè‰¯ã„

</div>
</div>

---

## 1.3 App.tsx å†…ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š

<div grid="~ cols-2 gap-4">
<div>

```diff
// src/App.tsx
- import { useState, useCallback, type ChangeEvent, type FormEvent } from 'react';
+ import { useEffect, useState, useCallback, type ChangeEvent, type FormEvent } from 'react';
+ import Dexie from 'dexie';
  import './App.css';
  import {
    // Material-UI ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ...
  } from '@mui/material';
  import { Colors, Message } from './types';

  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­å®š
+ const db = new Dexie('ChatApp');
+ db.version(1).stores({
+   messages: 'id, createdAt',
+ });

+ const MAX_MESSAGE_LENGTH = 140;

  const App = () => {
    // çŠ¶æ…‹ç®¡ç†...
  };
```

</div>
<div>

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šã®ãƒã‚¤ãƒ³ãƒˆ**
- `db.ts` ã¯ä½œæˆã›ãšï¼ŒApp.tsx å†…ã§ç›´æ¥è¨­å®š
- `new Dexie('ChatApp')` ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
- `version(1).stores()` ã§ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
- `createdAt` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 

</div>
</div>

---

# 2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ãƒ»å‰Šé™¤æ©Ÿèƒ½

## 2.1 æŠ•ç¨¿å‡¦ç†ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¯¾å¿œã«æ›´æ–°

<div grid="~ cols-2 gap-4">
<div>

```diff
      const newMessage: Message = {
        id: uuidv4(),
        text: text.trim(),
        image: imageData,
        imageName: image?.name,
        date: dateString,
        createdAt,
      };
      // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
+     await db.messages.add(newMessage);
      setMessages((prev) => [newMessage, ...prev]);
      setImage(null);
      setText('');
    } catch (error) {
```
</div>
<div>

**å‹å®šç¾©ã®æ›´æ–°ãƒã‚¤ãƒ³ãƒˆ**
- `uuidv4()` ã§ä¸€æ„ãª ID ã‚’ç”Ÿæˆã¯ç¶™ç¶š
- ä»Šå¾Œ Dexie ã§ã®ä¿å­˜æ©Ÿèƒ½ã‚’è¿½åŠ äºˆå®š

</div>
</div>

---

## 2.2 å‰Šé™¤å‡¦ç†ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¯¾å¿œã«æ›´æ–°

<div grid="~ cols-2 gap-4">
<div>

```tsx
// å‰Šé™¤å‡¦ç†ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¯¾å¿œã«æ›´æ–°
const deleteMessage = useCallback(
  async (id: string): Promise<void> => {
    const message = messages.find((m) => m.id === id);
    if (!message) return;

    const previewText =
      message.text.length > 20
        ? message.text.substring(0, 20) + '...'
        : message.text;

    if (window.confirm(`ã€Œ${previewText}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
      try {
        await db.messages.delete(id);
        setMessages((prev) => prev.filter((message) => message.id !== id));
      } catch (error) {
        console.error('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }
  },
  [messages],
);
```

</div>
<div>

```diff
  <Button
    size="small"
    color="error"
+   startIcon={<DeleteIcon />}
+   onClick={() => handleDeleteMessage(message.id)}
    sx={{
      borderRadius: 2,
      fontSize: { xs: '0.8rem', sm: '0.875rem' },
      '&:hover': {
        backgroundColor: 'rgba(244, 67, 54, 0.08)',
      },
    }}
  >
    å‰Šé™¤
  </Button>
```

**å‰Šé™¤å‡¦ç†ã®ãƒã‚¤ãƒ³ãƒˆ**
- `useCallback` ã§ãƒ¡ãƒ¢åŒ–
- ãƒ¡ãƒ¢ãƒªä¸Šã® state ã‹ã‚‰å‰Šé™¤
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§å®‰å…¨æ€§ã‚’ç¢ºä¿

</div>
</div>

---

# 3. ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ

<div grid="~ cols-2 gap-4">
<div>

```diff
const App = () => {
  const [text, setText] = useState<string>('');
  const [messages, setMessages] = useState<Message[]>([]);
  const [isPosting, setIsPosting] = useState<boolean>(false);
  const [image, setImage] = useState<File | null>(null);
+ const [isLoading, setIsLoading] = useState<boolean>(true);

+ // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èª­ã¿è¾¼ã¿
+ useEffect(() => {
+   const loadMessages = async (): Promise<void> => {
+     try {
+       const allMessages = await db.messages
+         .orderBy('createdAt')
+         .reverse()
+         .toArray();
+       setMessages(allMessages);
+     } catch (error) {
+       console.error('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
+     } finally {
+       setIsLoading(false);
+     }
+   };
+   loadMessages();
+ }, []);
```

</div>
<div>

```diff
  // èª­ã¿è¾¼ã¿ä¸­ã®è¡¨ç¤º
+ if (isLoading) {
+   return (
+     <Box
+       sx={{
+         minHeight: '100vh',
+         display: 'flex',
+         alignItems: 'center',
+         justifyContent: 'center',
+         background: colors.background,
+       }}
+     >
+       <Typography variant="h6">èª­ã¿è¾¼ã¿ä¸­...</Typography>
+     </Box>
+   );
+ }

  return (
    // æ—¢å­˜ã® JSX
  );
};
```

</div>
</div>

<div grid="~ cols-2 gap-4">
<div>

**åˆæœŸåŒ–å‡¦ç†ã®ãƒã‚¤ãƒ³ãƒˆ**
- `useEffect` ã§ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
- `db.messages.toArray()` ã§å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—
- `.reverse()` ã§æ–°ã—ã„é †ã«ä¸¦ã¹æ›¿ãˆ
- `isLoading` çŠ¶æ…‹ã§èª­ã¿è¾¼ã¿ä¸­ã‚’è¡¨ç¤º
- ç©ºã®ä¾å­˜é…åˆ—ã§åˆå›ã®ã¿å®Ÿè¡Œ

</div>
</div>

---

# 4. æ¬¡å›ã®äºˆå‘Š

æ¬¡å›ã¯ TypeScript ã§ã‚¢ãƒ—ãƒªã®ä»•ä¸Šã’ã¨æ©Ÿèƒ½æ‹¡å¼µã‚’è¡Œã„ã¾ã™ï¼š

- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†æ©Ÿèƒ½
- æ¤œç´¢æ©Ÿèƒ½ã®è¿½åŠ 
- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šæ©Ÿèƒ½
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

---
layout: section
---

# ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ ğŸ‰

## æ¬¡å›ã¯ã‚¢ãƒ—ãƒªã®ä»•ä¸Šã’ã‚’è¡Œã„ã¾ã™ï¼