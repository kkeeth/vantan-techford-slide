---
theme: default
background: https://picsum.photos/1920/1080
class: text-center
highlighter: shiki
lineNumbers: true
info: |
  ## TypeScript + React ハンズオン講座
  第17回：チャットアプリ開発（メッセージ表示機能編）
fonts:
  sans: "Josefin Sans"
  serif: "Noto Sans JP"
  mono: "Fira Code"

drawings:
  persist: false
transition: slide-left
title: TypeScript/React 入門講義
---

# TypeScript + React<br>ハンズオン講座

## 第17回：チャットアプリ開発<br>メッセージ表示機能編

<div class="pt-12">
  <span @click="$slidev.nav.next" class="px-2 py-1 rounded cursor-pointer" hover="bg-white bg-opacity-10">
    Press Space for next page <carbon:arrow-right class="inline"/>
  </span>
</div>

<div class="abs-br m-6 flex gap-2">
  <button @click="$slidev.nav.openInEditor()" title="Open in Editor" class="text-xl slidev-icon-btn opacity-50 !border-none !hover:text-white">
    <carbon:edit />
  </button>
</div>

<style>
h1 {
  background-color: #fff;
  background-image: none;
}
</style>

---
layout: section
---

# 出席確認✋️

---
layout: default
---

# 本日の内容

<Toc minDepth="2" maxDepth="2" />

<style>
h2 {
  margin: 1rem 0;
}
</style>

## 👉️ メッセージ表示機能を実装しよう！

---
layout: section
---

# メッセージ表示機能の実装

---

# 目次

## 1. TypeScript でのメッセージリストの表示
## 2. 型安全なメッセージカードのデザイン
## 3. TypeScript での削除機能の実装
## 4. 日時表示の改善
## 5. レスポンシブ対応

※今回は TypeScript でのリストレンダリングと型安全な削除機能を学びます．

<style>
h2 {
  margin-bottom: .5rem;
}
</style>

---

# 1. TypeScript でのメッセージリストの表示

## 1.1 必要なコンポーネントのインポート

メッセージ表示に必要なコンポーネントを追加インポートします：

```tsx
import {
  Container,
  Typography,
  TextField,
  Stack,
  Button,
  Card,
  CardContent,
  CardActions,
  Box,
  Paper,
  Fab,
  Divider,
  Chip,
} from '@mui/material';
import {
  Send as SendIcon,
  Image as ImageIcon,
  Delete as DeleteIcon,
} from '@mui/icons-material';
import type { Message } from './types';
```

<v-click>

📝 **新しいコンポーネント：**
- `Card`: カード形式のコンテナ
- `CardContent`: カードの内容部分
- `CardActions`: カードのアクション部分

</v-click>

---

## 1.2 メッセージリストの基本構造

投稿フォームの下にメッセージリストを追加します：

```tsx
        </Paper>

        {/* メッセージリスト */}
        <Stack spacing={3}>
          {messages.map((message: Message) => (
            <Card
              key={message.id}
              elevation={3}
              sx={{
                borderRadius: 3,
                overflow: 'hidden',
                background: colors.surface,
                backdropFilter: 'blur(20px)',
                border: '1px solid rgba(59, 130, 246, 0.1)',
                transition: 'all 0.3s ease',
                '&:hover': {
                  transform: 'translateY(-4px)',
                  boxShadow: '0 12px 30px rgba(59, 130, 246, 0.15)',
                },
              }}
            >
```

---

## 1.3 メッセージカードの中身

各メッセージカードの内容を実装します：

<div grid="~ cols-2 gap-4">
<div>

```tsx
              <CardContent sx={{ p: 3 }}>
                <Box sx={{ mb: 2 }}>
                  <Chip
                    label={message.date}
                    size="small"
                    variant="outlined"
                    sx={{
                      height: 24,
                      fontSize: '0.75rem',
                      borderColor: colors.primary,
                      color: colors.primary,
                      backgroundColor: 'rgba(59, 130, 246, 0.05)',
                    }}
                  />
                </Box>

                <Typography
                  variant="body1"
                  component="p"
                  sx={{
                    lineHeight: 1.7,
                    color: '#1f2937',
                    fontSize: '1rem',
                    fontWeight: 400,
                  }}
                >
                  {message.text}
                </Typography>
              </CardContent>
```

</div>
<div>

```tsx
              <Divider sx={{ borderColor: 'rgba(59, 130, 246, 0.1)' }} />

              <CardActions sx={{ justifyContent: 'flex-end', p: 2 }}>
                <Button
                  size="small"
                  color="error"
                  startIcon={<DeleteIcon />}
                  onClick={() => deleteMessage(message.id)}
                  sx={{
                    borderRadius: 2,
                    '&:hover': {
                      backgroundColor: 'rgba(244, 67, 54, 0.08)',
                    },
                  }}
                >
                  削除
                </Button>
              </CardActions>
            </Card>
          ))}
        </Stack>
      </Container>
    </Box>
```

</div>
</div>

---

## 1.4 動作確認

メッセージを投稿して，リストに表示されることを確認しましょう：

<v-click>

✅ **確認事項：**
- 投稿したメッセージがカード形式で表示される
- 新しいメッセージが上に表示される
- 日時が Chip 形式で表示される
- ホバー効果が動作している

</v-click>

<v-click>

📝 **TypeScript のポイント：** `map` のコールバックで `(message: Message)` と型を指定することで，安全なリストレンダリングが可能になります．

</v-click>

---

# 2. メッセージカードのデザイン改善

## 2.1 レスポンシブ対応の追加

メッセージカードにレスポンシブ対応を追加します：

```tsx
<Stack spacing={{ xs: 2, sm: 3 }}>
  {messages.map((message: Message) => (
    <Card
      key={message.id}
      elevation={3}
      sx={{
        borderRadius: { xs: 2, sm: 3 },
        overflow: 'hidden',
        background: colors.surface,
        backdropFilter: 'blur(20px)',
        border: '1px solid rgba(59, 130, 246, 0.1)',
        transition: 'all 0.3s ease',
        '&:hover': {
          transform: 'translateY(-4px)',
          boxShadow: '0 12px 30px rgba(59, 130, 246, 0.15)',
        },
      }}
    >
      <CardContent sx={{ p: { xs: 2, sm: 3 } }}>
```

---

## 2.2 テキストのレスポンシブ対応

テキスト部分もレスポンシブにします：

```tsx
<Typography
  variant="body1"
  component="p"
  sx={{
    lineHeight: 1.7,
    color: '#1f2937',
    fontSize: { xs: '0.95rem', sm: '1rem' },
    fontWeight: 400,
    mb: 0,
  }}
>
  {message.text}
</Typography>
```

```tsx
<CardActions sx={{ justifyContent: 'flex-end', p: { xs: 1.5, sm: 2 } }}>
  <Button
    size="small"
    color="error"
    startIcon={<DeleteIcon />}
    onClick={() => deleteMessage(message.id)}
    sx={{
      borderRadius: 2,
      fontSize: { xs: '0.8rem', sm: '0.875rem' },
      '&:hover': {
        backgroundColor: 'rgba(244, 67, 54, 0.08)',
      },
    }}
  >
    削除
  </Button>
</CardActions>
```

---

# 3. TypeScript での削除機能の実装

## 3.1 削除関数の作成

メッセージを削除する関数を実装します：

```tsx
const App = () => {
  const [text, setText] = useState<string>('');
  const [messages, setMessages] = useState<Message[]>([]);
  const [isPosting, setIsPosting] = useState<boolean>(false);

  // 既存の関数...

  const deleteMessage = (id: number): void => {
    if (window.confirm('本当に削除しますか？')) {
      setMessages((prev) => prev.filter((message) => message.id !== id));
    }
  };

  return (
    // 既存の JSX...
  );
};
```

<v-click>

📝 **TypeScript のポイント：** `deleteMessage(id: number): void` で引数と戻り値の型を明示し、安全な削除機能を実現しています．

</v-click>

---

## 3.2 削除の確認ダイアログ

より良いUXのために，削除確認ダイアログを改善しましょう：

```tsx
const deleteMessage = (id: number): void => {
  const message = messages.find((m: Message) => m.id === id);
  if (!message) return;

  const previewText = message.text.length > 20
    ? message.text.substring(0, 20) + '...'
    : message.text;

  if (window.confirm(`「${previewText}」を削除しますか？`)) {
    setMessages((prev) => prev.filter((message) => message.id !== id));
  }
};
```

<v-click>

📝 **TypeScript のポイント：** `find` メソッドの結果が `undefined` の可能性をチェックすることで，ランタイムエラーを防いでいます．

</v-click>

---

## 3.3 削除時のアニメーション（オプション）

削除時にスムーズなアニメーションを追加できます：

```tsx
const [deletingId, setDeletingId] = useState<number | null>(null);

const deleteMessage = async (id: number): Promise<void> => {
  const message = messages.find((m: Message) => m.id === id);
  if (!message) return;

  const previewText = message.text.length > 20
    ? message.text.substring(0, 20) + '...'
    : message.text;

  if (window.confirm(`「${previewText}」を削除しますか？`)) {
    setDeletingId(id);

    // アニメーション用の少しの遅延
    setTimeout(() => {
      setMessages((prev) => prev.filter((message) => message.id !== id));
      setDeletingId(null);
    }, 300);
  }
};
```

---

# 4. 日時表示の改善

## 4.1 相対時間の表示

「◯分前」のような相対時間表示を実装します：

```tsx
const formatRelativeTime = (date: string): string => {
  const now = new Date();
  const messageDate = new Date(date);
  const diffInMinutes = Math.floor((now.getTime() - messageDate.getTime()) / (1000 * 60));

  if (diffInMinutes < 1) return 'たった今';
  if (diffInMinutes < 60) return `${diffInMinutes}分前`;

  const diffInHours = Math.floor(diffInMinutes / 60);
  if (diffInHours < 24) return `${diffInHours}時間前`;

  const diffInDays = Math.floor(diffInHours / 24);
  if (diffInDays < 7) return `${diffInDays}日前`;

  return messageDate.toLocaleDateString();
};
```

---

## 4.2 日時表示の適用

作成した関数をメッセージ表示に適用します：

```tsx
<Chip
  label={formatRelativeTime(message.date)}
  size="small"
  variant="outlined"
  sx={{
    height: 24,
    fontSize: '0.75rem',
    borderColor: colors.primary,
    color: colors.primary,
    backgroundColor: 'rgba(59, 130, 246, 0.05)',
  }}
/>
```

<v-click>

📝 **ポイント：** より自然で分かりやすい時間表示になります．

</v-click>

---

## 4.3 ツールチップで詳細時間表示

詳細な時間をツールチップで表示できます：

```tsx
import { Tooltip } from '@mui/material';

<Tooltip title={message.date} arrow>
  <Chip
    label={formatRelativeTime(message.date)}
    size="small"
    variant="outlined"
    sx={{
      height: 24,
      fontSize: '0.75rem',
      borderColor: colors.primary,
      color: colors.primary,
      backgroundColor: 'rgba(59, 130, 246, 0.05)',
      cursor: 'help',
    }}
  />
</Tooltip>
```

---

# 5. メッセージが空の場合の表示

## 5.1 空状態の表示

メッセージがない時の表示を追加します：

```tsx
<Stack spacing={{ xs: 2, sm: 3 }}>
  {messages.length === 0 ? (
    <Paper
      elevation={1}
      sx={{
        p: 4,
        textAlign: 'center',
        background: 'rgba(255, 255, 255, 0.7)',
        borderRadius: 3,
      }}
    >
      <Typography
        variant="h6"
        color="text.secondary"
        sx={{ mb: 1 }}
      >
        📝 まだメッセージがありません
      </Typography>
      <Typography variant="body2" color="text.secondary">
        上のフォームから最初のメッセージを投稿してみましょう！
      </Typography>
    </Paper>
  ) : (
    messages.map((message: Message) => (
      // 既存のメッセージカード...
    ))
  )}
</Stack>
```

---

## 5.2 メッセージ数の表示

メッセージ数を表示する機能を追加：

```tsx
{messages.length > 0 && (
  <Typography
    variant="subtitle2"
    color="text.secondary"
    sx={{ mb: 2, textAlign: 'center' }}
  >
    {messages.length} 件のメッセージ
  </Typography>
)}

<Stack spacing={{ xs: 2, sm: 3 }}>
  {/* メッセージリスト */}
</Stack>
```

---

# 6. 動作確認と完成

## 6.1 機能テスト

以下の機能が正しく動作することを確認しましょう：

<v-click>

✅ **テスト項目：**
- メッセージが投稿されてリストに表示される
- 削除ボタンでメッセージが削除される
- 削除確認ダイアログが表示される
- 相対時間が正しく表示される
- 空状態の表示が機能している
- レスポンシブデザインが動作している

</v-click>

---

## 6.2 完成したコードの確認

メッセージ表示部分の最終的なコード：

<div grid="~ cols-2 gap-4">
<div>

```tsx
// 削除関数
const deleteMessage = (id: number): void => {
  const message = messages.find((m: Message) => m.id === id);
  if (!message) return;

  const previewText = message.text.length > 20
    ? message.text.substring(0, 20) + '...'
    : message.text;

  if (window.confirm(`「${previewText}」を削除しますか？`)) {
    setMessages((prev) => prev.filter((message) => message.id !== id));
  }
};

// 相対時間表示
const formatRelativeTime = (date: string): string => {
  const now = new Date();
  const messageDate = new Date(date);
  const diffInMinutes = Math.floor((now.getTime() - messageDate.getTime()) / (1000 * 60));

  if (diffInMinutes < 1) return 'たった今';
  if (diffInMinutes < 60) return `${diffInMinutes}分前`;

  const diffInHours = Math.floor(diffInMinutes / 60);
  if (diffInHours < 24) return `${diffInHours}時間前`;

  return messageDate.toLocaleDateString();
};
```

</div>
<div>

```tsx
// メッセージリスト表示
<Stack spacing={{ xs: 2, sm: 3 }}>
  {messages.length === 0 ? (
    <Paper sx={{ /* 空状態スタイル */ }}>
      <Typography variant="h6">
        📝 まだメッセージがありません
      </Typography>
    </Paper>
  ) : (
    messages.map((message: Message) => (
      <Card key={message.id} sx={{ /* カードスタイル */ }}>
        <CardContent>
          <Chip label={formatRelativeTime(message.date)} />
          <Typography>{message.text}</Typography>
        </CardContent>
        <CardActions>
          <Button onClick={() => deleteMessage(message.id)}>
            削除
          </Button>
        </CardActions>
      </Card>
    ))
  )}
</Stack>
```

</div>
</div>

---

# 7. 次回の予告

## 7.1 次回の内容

次回は TypeScript で画像アップロード機能を実装していきます：

- 型安全なファイル選択機能の実装
- TypeScript での画像プレビュー機能
- 画像付きメッセージの表示
- ファイルサイズ制限

<v-click>

## 7.2 今日の宿題 📚

1. 今日実装した TypeScript でのメッセージ表示機能を試してみる
2. TypeScript での React リストレンダリングについて復習する
3. 他のチャットアプリのメッセージ表示UIを観察してみる
4. TypeScript の Union Types や Optional プロパティについて学習する

</v-click>

---
layout: section
---

# お疲れさまでした！ 🎉

## 次回は画像機能を追加します！