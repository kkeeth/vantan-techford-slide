---
theme: default
background: https://picsum.photos/1920/1080
class: text-center
highlighter: shiki
lineNumbers: false
info: |
  ## TypeScript + React ãƒãƒ³ã‚ºã‚ªãƒ³è¬›åº§
  ç¬¬17å›ï¼šãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªé–‹ç™ºï¼ˆç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ç·¨ï¼‰
fonts:
  sans: "Josefin Sans"
  serif: "Noto Sans JP"
  mono: "Fira Code"

drawings:
  persist: false
transition: slide-left
title: TypeScript/React å…¥é–€è¬›ç¾©
---

# TypeScript + React<br>ãƒãƒ³ã‚ºã‚ªãƒ³è¬›åº§

## ç¬¬17å›ï¼šãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªé–‹ç™º<br>ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ç·¨

<div class="pt-12">
  <span @click="$slidev.nav.next" class="px-2 py-1 rounded cursor-pointer" hover="bg-white bg-opacity-10">
    Press Space for next page <carbon:arrow-right class="inline"/>
  </span>
</div>

<div class="abs-br m-6 flex gap-2">
  <button @click="$slidev.nav.openInEditor()" title="Open in Editor" class="text-xl slidev-icon-btn opacity-50 !border-none !hover:text-white">
    <carbon:edit />
  </button>
</div>

<style>
  h1 {
    color: #fff;
  }
</style>

---
layout: section
---

# å‡ºå¸­ç¢ºèªâœ‹ï¸

---
layout: default
---

# æœ¬æ—¥ã®å†…å®¹

<Toc minDepth="2" maxDepth="2" />

<style>
h2 {
  margin: 1rem 0;
}
</style>

## ğŸ‘‰ï¸ TypeScript ã§ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã‚ˆã†ï¼

---
layout: section
---

# ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã®å®Ÿè£…

---

# ç›®æ¬¡

## 1. ç”»åƒçŠ¶æ…‹ç®¡ç†ã¨ File API ã®åŸºæœ¬
## 2. ç”»åƒé¸æŠã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
## 3. ç”»åƒä»˜ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æŠ•ç¨¿
## 4. ç”»åƒè¡¨ç¤ºæ©Ÿèƒ½ã®å®Ÿè£…

â€» ç”»åƒæ©Ÿèƒ½ãŒå¿…è¦ã«ãªã£ãŸæ®µéšã§å‹å®šç¾©ã‚’æ‹¡å¼µã—ã¦ã„ãè‡ªç„¶ãªé–‹ç™ºãƒ•ãƒ­ãƒ¼ã§é€²ã‚ã¾ã™ï¼

<style>
h2 {
  margin-bottom: .5rem;
}
</style>

---

# 1. Message å‹ã®æ‹¡å¼µã¨ç”»åƒçŠ¶æ…‹ç®¡ç†

## 1.1 Message å‹ã« image ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ 

<div grid="~ cols-2 gap-4">
<div>

```tsx
// src/types.ts
export type Message = {
  id: number;
  text: string;
  date: string;
  image?: string; // ç”»åƒãƒ‡ãƒ¼ã‚¿ï¼ˆBase64ï¼‰ã‚’ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦è¿½åŠ 
};
```

</div>
<div>

**å‹ã®æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ**
- ç”»åƒæ©Ÿèƒ½ãŒå¿…è¦ã«ãªã£ãŸæ™‚ç‚¹ã§ `image?` ã‚’è¿½åŠ 
- `?` ã§ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã™ã‚‹ã“ã¨ã§æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’ç ´å£Šã—ãªã„
- `string` å‹ã§ Base64 ãƒ‡ãƒ¼ã‚¿ URL ã‚’æƒ³å®š
- å®Ÿéš›ã®é–‹ç™ºã§ã¯å¿…è¦ã«å¿œã˜ã¦å‹ã‚’æ‹¡å¼µ

</div>
</div>

---

## 1.2 ç”»åƒçŠ¶æ…‹ç®¡ç†ã®è¿½åŠ 

<div grid="~ cols-2 gap-4">
<div>

```diff
// src/App.tsx
const App = () => {
  const [text, setText] = useState<string>('');
  const [messages, setMessages] = useState<Message[]>([]);
  const [isPosting, setIsPosting] = useState<boolean>(false);
  const theme = useTheme();
  const colors: Colors = {
    // ä¸­ç•¥
  };

  // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ã™ã‚‹çŠ¶æ…‹ã‚’è¿½åŠ 
+ const [image, setImage] = useState<File | null>(null);

  // æ—¢å­˜ã®å‡¦ç†...
};
```

</div>
<div>

**ç”»åƒçŠ¶æ…‹ç®¡ç†ã®ãƒã‚¤ãƒ³ãƒˆ**
- `File | null` ã§ TypeScript ã® Union Types ã‚’æ´»ç”¨
- `File` ã¯ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–ã® File API ã®å‹
- `null` ã¯ç”»åƒãŒé¸æŠã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã‚’è¡¨ç¾
- ç”»åƒãŒå¿…è¦ã«ãªã£ãŸæ™‚ç‚¹ã§çŠ¶æ…‹ã‚’è¿½åŠ 

</div>
</div>

---

# 2. ç”»åƒé¸æŠã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

## 2.1 ç”»åƒé¸æŠãƒœã‚¿ãƒ³ã®æ©Ÿèƒ½è¿½åŠ 

<div grid="~ cols-2 gap-4">
<div>

```diff
// src/App.tsx
- import { Send as SendIcon, Delete as DeleteIcon } from '@mui/icons-material';
+ import {
+   Send as SendIcon,
+   Delete as DeleteIcon,
+   Image as ImageIcon,
+ } from '@mui/icons-material';

// ä¸­ç•¥

  const App = () => {
    // ä¸­ç•¥

+   const handleSelectImage = useCallback(
+     (e: ChangeEvent<HTMLInputElement>): void => {
+       const file = e.target.files?.[0];
+       if (file) {
+         setImage(file);
+       }
+     }, []);

    return (
```

</div>
<div>

```diff
  <TextField
    // ä¸­ç•¥
  />
+ <Button
+   variant="outlined"
+   component="label"
+   startIcon={<ImageIcon />}
+   sx={{
+     flex: 1,
+     width: { xs: '100%', sm: 'auto' },
+     height: 48,
+     borderRadius: 2,
+   }}
+ >
+   ç”»åƒã‚’è¿½åŠ 
+   <input
+     type="file"
+     hidden
+     accept="image/png, image/jpg, image/jpeg, image/gif"
+     onChange={handleSelectImage}
+   />
+ </Button>
  <Fab>
```

</div>
</div>

---

## 2.2 ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®è¿½åŠ 

<div grid="~ cols-2 gap-4">
<div>

```tsx
const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB
const MAX_FILENAME_LENGTH = 100;

//ï¼ˆä¸­ç•¥ï¼‰

// ãƒ•ã‚¡ã‚¤ãƒ«ã®å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯é–¢æ•°ã‚’è¿½åŠ 
const validateFile = (file: File): string => {
  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã®æ¤œè¨¼
  const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
  if (!allowedTypes.includes(file.type)) {
    return 'JPEGï¼ŒPNGï¼ŒGIF ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™';
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®æ¤œè¨¼ï¼ˆ5MBä»¥ä¸‹ï¼‰
  if (file.size > MAX_FILE_SIZE) {
    return `ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ï¼ˆ${MAX_FILE_SIZE} MB ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ï¼‰`;
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«åã®é•·ã•ãƒã‚§ãƒƒã‚¯
  if (file.name.length > MAX_FILENAME_LENGTH) {
    return `ãƒ•ã‚¡ã‚¤ãƒ«åãŒé•·ã™ãã¾ã™ï¼ˆ${MAX_FILENAME_LENGTH} æ–‡å­—ä»¥å†…ã«ã—ã¦ãã ã•ã„ï¼‰`;
  }

  return '';
};
```

</div>
<div>

```diff
  const handleSelectImage = useCallback(
    (e: ChangeEvent<HTMLInputElement>): void => {
      const file = e.target.files?.[0];
      if (file) {
+       const error = validateFile(file);
+       if (error) {
+         alert(error);
+         e.target.value = ''; // input ã‚’ã‚¯ãƒªã‚¢
+         return;
+       }
        setImage(file);
      }
    },
    [],
  );
```

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…**
- `File` å‹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‹å®‰å…¨ã«ä½¿ç”¨
- `file.type` ã§ MIME ã‚¿ã‚¤ãƒ—ã‚’ãƒã‚§ãƒƒã‚¯
- `file.size` ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’ãƒã‚§ãƒƒã‚¯
- ãƒ•ã‚¡ã‚¤ãƒ«åã®é•·ã•ã‚‚ãƒã‚§ãƒƒã‚¯
- ã‚¨ãƒ©ãƒ¼æ™‚ã¯ input ã‚’ã‚¯ãƒªã‚¢ã—ã¦å†é¸æŠå¯èƒ½ã«

</div>
</div>

---

## 2.3 ç”»åƒé¸æŠï¼ŒæŠ•ç¨¿ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´

```diff
+   <Box
+     sx={{
+       display: 'flex',
+       gap: 2,
+       alignItems: 'center',
+       flexDirection: { xs: 'column', sm: 'row' },
+     }}
+   >
      <Button>
        ï¼ˆä¸­ç•¥ï¼‰
      </Button>
      <Fab>
        ï¼ˆä¸­ç•¥ï¼‰
      </Fab>
+   </Box>
  </Stack>
```

---

# 3. ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½

## 3.1 ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å®Ÿè£…

<div grid="~ cols-2 gap-4">
<div>

```tsx
// <TextField /> ã®ä¸‹ã«è¨˜è¿°
{image && (
  <Paper
    elevation={2}
    sx={{
      p: 2,
      borderRadius: 2,
      background: 'rgba(255, 255, 255, 0.8)',
      border: '1px solid rgba(59, 130, 246, 0.1)',
    }}
  >
    <Typography
      variant="body2"
      color="text.secondary"
      sx={{ mb: 1 }}
    >
      ğŸ“¸ ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
    </Typography>
```


</div>
<div>

```tsx
    <Box
      sx={{
        display: 'flex',
        justifyContent: 'center',
        width: '100%',
      }}
    >
      <Box
        component="img"
        alt="Preview"
        src={URL.createObjectURL(image)}
        sx={{
          maxWidth: '80%',
          maxHeight: 200,
          objectFit: 'contain',
          borderRadius: 2,
          boxShadow: '0 4px 12px rgba(0,0,0,0.1)',
        }}
      />
    </Box>
  </Paper>
```

</div>
</div>

---

## 3.2 ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ“ä½œæ©Ÿèƒ½ã®è¿½åŠ 

<div grid="~ cols-2 gap-4">
<div>

```tsx
    {/* ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã® Box ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸‹ */}
    <Box
      sx={{
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        mt: 2,
      }}
    >
      <Typography variant="caption" color="text.secondary">
        {image.name} ({Math.round(image.size / 1024)}KB)
      </Typography>
      <Button
        size="small"
        color="error"
        startIcon={<DeleteIcon />}
        sx={{
          borderRadius: 2,
          fontSize: { xs: '0.8rem', sm: '0.875rem' },
          '&:hover': {
            backgroundColor: 'rgba(244, 67, 54, 0.08)',
          }
        }}
      >
        å‰Šé™¤
      </Button>
    </Box>
```

</div>
<div>

**ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±è¡¨ç¤º**
- `image.name` ã§ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¡¨ç¤º
- `image.size / 1024` ã§KBå˜ä½ã§ã‚µã‚¤ã‚ºè¡¨ç¤º
- å‰Šé™¤ãƒœã‚¿ãƒ³ã§ `setImage(null)` ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ã‚¯ãƒªã‚¢
- TypeScript ãŒ `image` ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å­˜åœ¨ã‚’ä¿è¨¼

</div>
</div>

---

# 4. ç”»åƒä»˜ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æŠ•ç¨¿

## 4.1 ç”»åƒå¯¾å¿œã®æŠ•ç¨¿å‡¦ç†ã«æ›´æ–°

<div grid="~ cols-2 gap-4">
<div>

```diff
// src/types.ts
  export type Message = {
    id: string;
    text: string;
    date: string;
+   image?: string;
+   imageName?: string;
+   createdAt?: Date;
  }
```

```tsx
// src/App.tsx
// ç”»åƒã‚’ Base64 ã«å¤‰æ›
const readImageAsDataURL = (file: File): Promise<string> => {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result as string);
    reader.onerror = () => reject(reader.error);
    reader.readAsDataURL(file);
  });
};
```

</div>
<div>

**FileReader API ã®ä½¿ã„æ–¹**
- `FileReader` ã¯ File ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’èª­ã¿è¾¼ã‚€ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº– API
- `readAsDataURL()` ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ Base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ URL ã«å¤‰æ›
- `onload` ã‚¤ãƒ™ãƒ³ãƒˆã§èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®å‡¦ç†ã‚’å®šç¾©
- `onerror` ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡¦ç†ã‚’å®šç¾©
- `reader.result` ã«å¤‰æ›çµæœï¼ˆBase64 æ–‡å­—åˆ—ï¼‰ãŒæ ¼ç´ã•ã‚Œã‚‹
- `Promise` ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ã§ async/await ã§ä½¿ãˆã‚‹å½¢ã«
- ãƒ‡ãƒ¼ã‚¿ URL å½¢å¼ï¼š `data:image/png;base64,..`

</div>
</div>

---

## 4.2 handlePost é–¢æ•°ã®æ›´æ–°

<div grid="~ cols-2 gap-4">
<div>

```diff
ï¼ˆç¶šãï¼‰
  const handlePost = useCallback(
-   (e: FormEvent<HTMLFormElement>): void => {
+   async (e: FormEvent<HTMLFormElement>): Promise<void> => {
      e.preventDefault();

      // ä¸­ç•¥

      try {
+       const createdAt = new Date();
+       const dateString = createdAt.toLocaleString();
+       const imageData = image ? await readImageAsDataURL(image) : undefined;
```

</div>
<div>

```diff
+         const newMessage: Message = {
+           id: uuidv4(),
+           text: text.trim(),
+           image: imageData,
+           imageName: image?.name,
+           date: dateString,
+           createdAt,
+         };
          setMessages((prev) => [newMessage, ...prev]);
+         setImage(null);
          setText('');
        } catch (error) {
          // ä¸­ç•¥
        },
-       [text],
+       [text, image],
      );
```

</div>
</div>

---

# 5. ç”»åƒè¡¨ç¤ºæ©Ÿèƒ½ã®å®Ÿè£…

## 5.1 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰ã«ç”»åƒè¡¨ç¤ºã‚’è¿½åŠ 

<div grid="~ cols-2 gap-4">
<div>

```diff
// src/App.tsx
  <CardContent sx={{ p: { xs: 2, sm: 3 } }}>
    {/* æ—¥æ™‚è¡¨ç¤º */}
    <Box sx={{ mb: 2 }}>
      // ä¸­ç•¥
    </Box>

    {/* ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º */}
    <Typography
      variant="body1"
      component="p"
      sx={{
        lineHeight: 1.7,
        color: '#1f2937',
+       mb: message.image ? 2 : 0, // ç”»åƒãŒã‚ã‚Œã°ä¸‹ãƒãƒ¼ã‚¸ãƒ³è¿½åŠ 
        fontSize: { xs: '0.95rem', sm: '1rem' },
      }}
    >
      {message.text}
    </Typography>
```

</div>
<div>

```diff
+   {/* ç”»åƒè¡¨ç¤º */}
+   {message.image && (
+     <Box sx={{ display: 'flex', justifyContent: 'center', mt: 2 }}>
+       <Box
+         component="img"
+         src={message.image}
+         alt={message.imageName}
+         sx={{
+           maxWidth: '100%',
+           maxHeight: 400,
+           objectFit: 'contain',
+           borderRadius: 2,
+           boxShadow: '0 6px 20px rgba(0,0,0,0.1)',
+         }}
+       />
+     </Box>
+   )}
  </CardContent>
```

</div>
</div>

---

## 5.2 ç”»åƒã®ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š

<div grid="~ cols-2 gap-4">
<div>

```diff
          objectFit: 'contain',
          borderRadius: 2,
          boxShadow: '0 6px 20px rgba(0,0,0,0.1)',
+         transition: 'transform 0.3s ease',
+         '&:hover': {
+           transform: 'scale(1.02)',
+         },
        }}
      />
    </Box>
  )}
```

</div>
<div>

**UX å‘ä¸Šã®ãƒã‚¤ãƒ³ãƒˆ**
- ãƒ›ãƒãƒ¼æ™‚ã« slight scale ã§è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- `objectFit: 'contain'` ã§ç”»åƒã®ç¸¦æ¨ªæ¯”ã‚’ç¶­æŒ
- `transition` ã§ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã§ç”»åƒã‚µã‚¤ã‚ºã‚’åˆ¶é™

</div>
</div>

---

# 6. æ¬¡å›ã®äºˆå‘Š

### æ¬¡å›ã¯ TypeScript ã§ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ï¼š

- Dexie.js ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ App.tsx å†…ã§ã®è¨­å®š
- `types.ts` ã® Message å‹ã« `createdAt?: Date` ã‚’è¿½åŠ 
- `types.ts` ã« `MessageWithoutId` å‹ã‚’è¿½åŠ 
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ç”»åƒã®æ°¸ç¶šåŒ–
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã®å®Ÿè£…

---
layout: section
---

# ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ ğŸ‰

## æ¬¡å›ã¯ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½ã‚’ä½œã‚Šã¾ã™ï¼