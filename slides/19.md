---
theme: default
background: https://picsum.photos/1920/1080
class: text-center
highlighter: shiki
lineNumbers: false
info: |
  ## TypeScript + React ãƒãƒ³ã‚ºã‚ªãƒ³è¬›åº§
  ç¬¬19å›ï¼šãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªé–‹ç™ºï¼ˆé«˜åº¦ãªæ©Ÿèƒ½è¿½åŠ ç·¨ï¼‰
fonts:
  sans: "Josefin Sans"
  serif: "Noto Sans JP"
  mono: "Fira Code"

drawings:
  persist: false
transition: slide-left
title: TypeScript/React å…¥é–€è¬›ç¾©
---

# TypeScript + React<br>ãƒãƒ³ã‚ºã‚ªãƒ³è¬›åº§

## ç¬¬19å›ï¼šãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªé–‹ç™º<br>é«˜åº¦ãªæ©Ÿèƒ½è¿½åŠ ç·¨

<div class="pt-12">
  <span @click="$slidev.nav.next" class="px-2 py-1 rounded cursor-pointer" hover="bg-white bg-opacity-10">
    Press Space for next page <carbon:arrow-right class="inline"/>
  </span>
</div>

<div class="abs-br m-6 flex gap-2">
  <button @click="$slidev.nav.openInEditor()" title="Open in Editor" class="text-xl slidev-icon-btn opacity-50 !border-none !hover:text-white">
    <carbon:edit />
  </button>
</div>

<style>
  h1 {
    color: #fff;
  }
</style>

---
layout: section
---

# å‡ºå¸­ç¢ºèªâœ‹ï¸

---
layout: default
---

# æœ¬æ—¥ã®å†…å®¹

<Toc minDepth="2" maxDepth="2" />

<style>
h2 {
  margin: 1rem 0;
}
</style>

## ğŸ‘‰ï¸ ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚’ã•ã‚‰ã«ä¾¿åˆ©ã«ã—ã‚ˆã†ï¼

---
layout: section
---

# ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã®é«˜åº¦ãªæ©Ÿèƒ½è¿½åŠ 

---

# ç›®æ¬¡

## 1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†å‰²ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
## 2. Props Drilling ã®å•é¡Œã¨è§£æ±ºç­–
## 3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†æ©Ÿèƒ½
## 4. æ¤œç´¢æ©Ÿèƒ½ã®è¿½åŠ 
## 5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

â€»ä»Šå›ã¯ TypeScript ã§ã‚ˆã‚Šå®Ÿç”¨çš„ãªãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’è¿½åŠ ã—ï¼Œè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚å­¦ã³ã¾ã™ï¼

<style>
h2 {
  margin-bottom: .5rem;
}
</style>

---

# 1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†å‰²ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

## 1.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†å‰²ã®å¿…è¦æ€§

ğŸ“ **ç¾çŠ¶ã®èª²é¡Œï¼š**
- App.tsx ãŒé•·ããªã‚Šã™ãã¦ã„ã‚‹ï¼ˆ400è¡Œä»¥ä¸Šï¼‰
- UIãƒ»ãƒ­ã‚¸ãƒƒã‚¯ãƒ»ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãŒæ··åœ¨
- å†åˆ©ç”¨æ€§ãŒä½ã„
- ãƒ†ã‚¹ãƒˆãŒã—ã«ãã„
- ã‚³ãƒ¼ãƒ‰ã®è¦‹é€šã—ãŒæ‚ªã„

ğŸ“ **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®æ–¹é‡ï¼š**
1. **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†å‰²**: MessageItem, MessageForm, MessageList ãªã©
2. **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£åˆ†é›¢**: dateFormatter, fileValidator ãªã©
3. **çŠ¶æ…‹ç®¡ç†ã®ä¸€å…ƒåŒ–**: App.tsx ã§ã™ã¹ã¦ã®çŠ¶æ…‹ã‚’ç®¡ç†
4. **Component Composition**: Props Drilling ã‚’å›é¿ã™ã‚‹è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

---

## 1.2 ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®å…¨ä½“åƒ

ä»Šå›ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã§ä½œæˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼š

<div grid="~ cols-2 gap-4">
<div>

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ MessageList.tsx
â”‚   â”œâ”€â”€ MessageItem.tsx
â”‚   â”œâ”€â”€ MessageForm.tsx
â”‚   â””â”€â”€ ImageUploader.tsx
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ dateFormatter.ts
â”‚   â””â”€â”€ fileValidator.ts
â””â”€â”€ App.tsxï¼ˆçŠ¶æ…‹ç®¡ç†ã®ä¸­å¿ƒï¼‰
```

</div>
<div>

ğŸ“ **åˆ†å‰²ã®å„ªå…ˆé †ä½ï¼š**

1. **MessageItem** - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆè¡¨ç¤ºã®ã¿ï¼‰
2. **MessageList** - Component Composition ãƒ‘ã‚¿ãƒ¼ãƒ³
3. **MessageForm** - å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
4. **ImageUploader** - ç”»åƒæ·»ä»˜ç”¨
5. **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£** - å…±é€šé–¢æ•°ï¼ˆç´”ç²‹é–¢æ•°ã®ã¿ï¼‰
6. **App.tsx** - ã™ã¹ã¦ã®çŠ¶æ…‹ã‚’ä¸€å…ƒç®¡ç†

</div>
</div>

---

## 1.3 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºç”¨ã® MessageItem ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

æ–°ã—ã `src/components/MessageItem.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºéƒ¨åˆ†ã‚’åˆ‡ã‚Šå‡ºã—ã¾ã™

<div grid="~ cols-2 gap-4">
<div>

```tsx
// src/components/MessageItem.tsx
import {
  Box,
  Button,
  Card,
  CardContent,
  CardActions,
  Chip,
  Divider,
  Typography,
} from '@mui/material';
import { Delete as DeleteIcon } from '@mui/icons-material';
import type { Message } from '../types';

type MessageItemProps = {
  message: Message;
  colors: Colors;
  onDeleteMessage: (id: string) => void;
};
```

</div>
<div>

```tsx
export const MessageItem = ({ message, colors, onDeleteMessage}: MessageItemProps) => {
  const formatRelativeTime = (date: string): string => {
    // ã¾ã‚‹ã£ã¨ App.tsx ã‹ã‚‰ç§»æ¤
  };

  return (
    // ã“ã¡ã‚‰ã‚‚ã¾ã‚‹ã£ã¨ App.tsx ã‹ã‚‰ç§»æ¤
    <Card key={message.id} sx={{ ... }}>
      <CardContent>...</CardContent>
      <Divider />
      <CardActions>...</CardActions>
    </Card>
  );
};
```

```diff
    <Button
      size="small"
      color="error"
      startIcon={<DeleteIcon />}
-     onClick={() => handleDeleteMessage(message.id)}
+     onClick={() => onDeleteMessage(message.id)}
```

</div>
</div>

---

## 1.4 App.tsx ã§ MessageItem ã‚’ä½¿ç”¨

<div grid="~ cols-2 gap-4">
<div>

```diff
   Container,
   Typography,
   Box,
-  Card,
-  CardContent,
-  CardActions,
   Paper,
   TextField,
   Button,
   Stack,
   Fab,
-  Divider,
-  Chip,
   useTheme,
 } from '@mui/material';
-import {
-  Send as SendIcon,
-  Delete as DeleteIcon,
-  Image as ImageIcon,
-} from '@mui/icons-material';
+import { Send as SendIcon, Image as ImageIcon } from '@mui/icons-material';
 import { v4 as uuidv4 } from 'uuid';
+import { MessageItem } from './components/MessageItem';
 import type { Colors, Message } from './types';
```

</div>
<div>

```diff
-  const formatRelativeTime = (date: string): string => {
-   // çœç•¥
-  };
```

```diff
-         {messages.map((message) => (
-           <Card key={message.id} sx={{ ... }}>
-             <CardContent>...</CardContent>
-             <Divider />
-             <CardActions>...</CardActions>
-           </Card>
-         ))}
+         {messages.map((message) => (
+           <MessageItem
+             key={message.id}
+             message={message}
+             colors={colors}
+             onDeleteMessage={handleDeleteMessage}
+           />
+         ))}
```

</div>
</div>

---

## 1.5 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆå…¨ä½“ã® MessageList ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

<div grid="~ cols-2 gap-4">
<div>

```tsx
// src/components/MessageList.tsx
import { Stack, Paper, Typography } from '@mui/material';
import { MessageItem } from './MessageItem';
import type { Message } from '../types';

type MessageListProps = {
  messages: Message[];
  colors: Colors;
  onDeleteMessage: (id: string) => void;
};

export const MessageList = ({
  messages,
  colors,
  onDeleteMessage,
}: MessageListProps) => {
  return (
    <Stack spacing={{ xs: 2, sm: 3 }}>
      {messages.length === 0 ? (
        <Paper
          elevation={1}
          sx={{ /*...*/}}
        >
```

</div>
<div>

```tsx
          <Typography variant="h6" color="text.secondary" sx={{ mb: 1 }}>
            ğŸ“ ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“
          </Typography>
          <Typography variant="body2" color="text.secondary">
            ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼
          </Typography>
        </Paper>
      ) : (
        <>
          <Typography variant="subtitle2" /*...*/>
            {messages.length} ä»¶ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
          </Typography>
          {messages.map((message: Message) => (
            <MessageItem
              key={message.id}
              message={message}
              colors={colors}
              onDeleteMessage={onDeleteMessage}
            />
          ))}
        </>
      )}
    </Stack>
  );
};
```

</div>
</div>

---

## 1.6 App.tsx ã§ MessageList ã‚’ä½¿ç”¨

App.tsx ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆè¡¨ç¤ºéƒ¨åˆ†ã‚’ MessageList ã«ç½®ãæ›ãˆã¾ã™ï¼

<div grid="~ cols-2 gap-4">
<div>

```diff
// src/App.tsx
  import {
    Container,
    Typography,
    Box,
-   Paper,
    TextField,
    Button,
    Stack,
    Fab,
    useTheme,
  } from '@mui/material';
  import { Send as SendIcon, Image as ImageIcon } from '@mui/icons-material';
  import { v4 as uuidv4 } from 'uuid';
- import { MessageItem } from './components/MessageItem';
+ import { MessageList } from './components/MessageList';
  import type { Colors, Message } from './types';
```

</div>
<div>

```diff
        {/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆ */}
-       <Stack spacing={{ xs: 2, sm: 3 }}>
-         {messages.length === 0 ? (
-           <Paper>...</Paper>
-         ) : (
-           <>
-             <Typography>...</Typography>
-             {messages.map((message: Message) => (
-               <MessageItem ... />
-             ))}
-           </>
-         )}
-       </Stack>
+       <MessageList
+         messages={messages}
+         colors={colors}
+         onDeleteMessage={onDeleteMessage}
+       />
      </Container>
    </Box>
  );
```

</div>
</div>

---

## 1.7 MessageForm ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

æ–°ã—ã `src/components/MessageForm.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ï¼Œãƒ•ã‚©ãƒ¼ãƒ éƒ¨åˆ†ã‚’åˆ‡ã‚Šå‡ºã—ã¾ã™

<div grid="~ cols-2 gap-4">
<div>

```tsx
import type { FormEvent, ChangeEvent } from 'react';
import {
  // çœç•¥
} from '@mui/material';
import {
  Send as SendIcon,
  Delete as DeleteIcon,
  Image as ImageIcon,
} from '@mui/icons-material';
import type { Colors } from '../types';

type MessageFormProps = {
  text: string;
  isPosting: boolean;
  image: File | null;
  colors: Colors;
  onTextChange: (e: ChangeEvent<HTMLInputElement>) => void;
  onSubmit: (e: FormEvent<HTMLFormElement>) => void;
  onSelectImage: (e: ChangeEvent<HTMLInputElement>) => void;
  onDeleteImage: () => void;
};
```

</div>
<div>

```tsx
export const MessageForm = ({
  text,
  isPosting,
  image,
  colors,
  onTextChange,
  onSubmit,
  onSelectImage,
  onDeleteImage,
}: MessageFormProps) => {
  return (
    <Paper
      elevation={2}
      sx={{/* ... */}}
    >
      {/* ã¾ã‚‹ã£ã¨ App.tsx ã‹ã‚‰ç§»æ¤ */}
    </Paper>
  );
};
```

</div>
</div>

---

## 1.8 MessageForm ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ï¼š

<div grid="~ cols-2 gap-4">
<div>

```diff
export const MessageForm = ({ /* props */ }: MessageFormProps) => {
  return (
    <Paper elevation={2} sx={{ /* ... */ }}>
-     <form onSubmit={handlePost}>
+     <form onSubmit={onSubmit}>
        <Stack spacing={{ xs: 2, sm: 3 }}>
          <TextField
            label="ä»Šã®æ°—åˆ†ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿ"
            multiline
            fullWidth
            rows={4}
            variant="outlined"
            value={text}
-           onChange={handleTextChange}
+           onChange={onTextChange}
            sx={{ /* ... */ }}
          />
```

</div>
<div>

```diff
-               <Button
-                 size="small"
-                 color="error"
-                 onClick={() => setImage(null)}
-               >
+               <Button size="small" color="error" onClick={onDeleteImage}>
                  å‰Šé™¤
                </Button>
              </Box>
            </Paper>
          )}

ã€€ã€€ã€€ã€€ã€€ã€€// ï¼ˆä¸­ç•¥ï¼‰

            ç”»åƒã‚’è¿½åŠ 
            <input
              type="file"
              hidden
              accept="image/png, image/jpg, image/jpeg, image/gif"
-             onChange={handleSelectImage}
+             onChange={onSelectImage}
            />
          </Button>
```

</div>
</div>

---

## 1.9 ImageUploader ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

æ–°ã—ã `src/components/ImageUploader.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ï¼Œç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’ç‹¬ç«‹ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦ä½œæˆã—ã¾ã™ãŒï¼ŒåŸºæœ¬çš„ã«ã¯ MessageForm.tsx ã‹ã‚‰è©²å½“ã®ã‚³ãƒ¼ãƒ‰ã‚’ç§»æ¤ã—ã¾ã™ï¼

<div grid="~ cols-2 gap-4">
<div>

```tsx
import type { ChangeEvent } from 'react';
import { Box, Button, Fab } from '@mui/material';
import { Image as ImageIcon, Send as SendIcon } from '@mui/icons-material';
import { Colors } from '../types';

type ImageUploaderProps = {
  text: string;
  isPosting: boolean;
  colors: Colors;
  onSelectImage: (e: ChangeEvent<HTMLInputElement>) => void;
};

export const ImageUploader = ({
  text,
  isPosting,
  colors,
  onSelectImage,
}: ImageUploaderProps) => {
```

</div>
<div>

```tsx
  return (
    <>
      <Box
        sx={{/** ... */}}
      >
        <Button /** ... */>
          ç”»åƒã‚’è¿½åŠ 
          <input
            type="file"
            hidden
            accept="image/png, image/jpg, image/jpeg, image/gif"
            onChange={onSelectImage}
          />
        </Button>

        <Fab /** ... */ >
          <SendIcon />
        </Fab>
      </Box>
    </>
  );
};
```

æ¬¡ã®ãƒšãƒ¼ã‚¸ã§ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™

</div>
</div>

---

## 1.9 ImageUploader ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆï¼ˆç¶šãï¼‰

ç”»åƒãŒé¸æŠã•ã‚ŒãŸå ´åˆã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã‚’è¿½åŠ ã—ã¾ã™ï¼š

<div grid="~ cols-2 gap-4">
<div>

```diff
- import { Box, Button, Fab } from '@mui/material';
+ import { Box, Button, Fab, Paper, Typography } from '@mui/material';

  type ImageUploaderProps = {
    text: string;
    isPosting: boolean;
+   image: File | null;
    colors: Colors;
    onSelectImage: (e: ChangeEvent<HTMLInputElement>) => void;
+   onDeleteImage: () => void;
  };

  export const ImageUploader = ({
    text,
    isPosting,
+   image,
    colors,
    onSelectImage,
+   onDeleteImage,
  }: ImageUploaderProps) => {
```

</div>
<div>

```diff
  return (
    <>
+     {/* ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */}
+     {image && (
+       <Paper
+         elevation={2}
+         sx={{/* ... */}}
+       >
+         <Typography variant="body2" color="text.secondary" sx={{ mb: 1 }}>
+           ğŸ“¸ ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
+         </Typography>
+         <Box /* ...*/>...</Box>
+         <Box /* ...*/>...</Box>
+       </Paper>
+     )}

      {/* ç”»åƒè¿½åŠ ãƒœã‚¿ãƒ³ */}
      <Box>
        <Button /* ... */>ç”»åƒã‚’è¿½åŠ </Button>
        <Fab>...</Fab>
      </Box>

```

</div>
</div>

---

## 1.10 MessageForm ã« ImageUploader ã‚’çµ±åˆ

<div grid="~ cols-2 gap-4">
<div>

**Import ã®è¿½åŠ :**

```diff
// src/components/MessageForm.tsx
  import type { FormEvent, ChangeEvent } from 'react';
  import {
-   Button,
-   Box,
    Paper,
    Stack,
    TextField,
-   Fab,
-   Typography,
  } from '@mui/material';
- import { Send as SendIcon, Image as ImageIcon } from '@mui/icons-material';
+ import { ImageUploader } from './ImageUploader';
```


</div>
<div>

**ãƒ•ã‚©ãƒ¼ãƒ å†…ã®å¤‰æ›´:**

```diff
  <form onSubmit={onSubmit}>
    <Stack spacing={{ xs: 2, sm: 3 }}>
      <TextField /* ... */ />

-     {/* ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼éƒ¨åˆ†ã‚’å‰Šé™¤ */}
-     {image && (
-       <Paper>...</Paper>
-     )}

+     <ImageUploader
+       text={text}
+       isPosting={isPosting}
+       image={image}
+       colors={colors}
+       onSelectImage={onSelectImage}
+       onDeleteImage={onDeleteImage}
+     />
```

ã“ã‚Œã§ MessageForm ã¨ ImageUploader ã®çµ±åˆãŒå®Œäº†ã—ã¾ã—ãŸï¼

</div>
</div>

---

## 1.11 App.tsx ã§ MessageForm ã‚’ä½¿ç”¨

<div grid="~ cols-2 gap-4">
<div>

```diff
// src/App.tsx
  import { useState, useCallback, type FormEvent, type ChangeEvent } from 'react';
  import {
    Container,
    Typography,
    Box,
-   Paper,
-   TextField,
-   Button,
-   Stack,
-   Fab,
    useTheme,
  } from '@mui/material';
  import { v4 as uuidv4 } from 'uuid';
  import { MessageItem } from './components/MessageItem';
+ import { MessageForm } from './components/MessageForm';
  import type { Colors, Message } from './types';
```

</div>
<div>

```diff
    <Box sx={{ minHeight: '100vh', background: colors.gradient }}>
      <Container maxWidth="md" sx={{ py: 4 }}>
-       <Paper elevation={2} sx={{ ... }}>
-         <form onSubmit={handlePost}>
-           <Stack spacing={{ xs: 2, sm: 3 }}>
-             <TextField /* ... */ />
-             {image && (
-               <Paper>...</Paper>
-             )}
-             <Box>
-               <Button>ç”»åƒã‚’è¿½åŠ </Button>
-               <Fab>...</Fab>
-             </Box>
-           </Stack>
-         </form>
-       </Paper>
+       <MessageForm
+         text={text}
+         isPosting={isPosting}
+         image={image}
+         colors={colors}
+         onTextChange={handleTextChange}
+         onSubmit={handlePost}
+         onSelectImage={handleSelectImage}
+         onDeleteImage={() => setImage(null)}
+       />
```

</div>
</div>

---

## 1.12 ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®åˆ†é›¢

<div grid="~ cols-2 gap-4">
<div>

```tsx
// src/utils/validator.ts
const MAX_MESSAGE_LENGTH = 140;
const MAX_SIZE = 5 * 1024 * 1024; // 5MB
const MAX_FILENAME_LENGTH = 100;
const ALLOWED_TYPES = [
  'image/jpeg',
  'image/jpg',
  'image/png',
  'image/gif',
];

export const validateMessage = (str: string): string => {
  if (!str.trim()) {
    return 'å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
  }
  if (str.length > MAX_MESSAGE_LENGTH) {
    return `${MAX_MESSAGE_LENGTH} æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„`;
  }
  return '';
};

ï¼ˆç¶šãï¼‰
```

</div>
<div>

```ts
ï¼ˆç¶šãï¼‰

export const validateFile = (file: File): string => {
  if (!FILE_LIMITS.ALLOWED_TYPES.includes(file.type)) {
    return 'JPEG, PNG, GIF ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™';
  }
  if (file.size > FILE_LIMITS.MAX_SIZE) {
    return 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ï¼ˆæœ€å¤§5MBï¼‰';
  }
  if (file.name.length > FILE_LIMITS.MAX_FILENAME_LENGTH) {
    return 'ãƒ•ã‚¡ã‚¤ãƒ«åãŒé•·ã™ãã¾ã™';
  }
  return '';
};
```

</div>
</div>

---

## 1.12 ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®åˆ†é›¢ï¼ˆç¶šãï¼‰

```diff
// src/App.tsx
  import { useState, useCallback, type FormEvent, type ChangeEvent } from 'react';
+ import { validateMessage, validateFile } from './utils/validator';

  const MAX_MESSAGE_LENGTH = 500;
- const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB
- const MAX_FILENAME_LENGTH = 100;

- const validateMessage = (str: string): string => {
-   // çœç•¥
- }

- const validateFile = (file: File): string | null => {
-   // çœç•¥
- }
```

---

## 1.12 ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®åˆ†é›¢ï¼ˆç¶šãï¼‰

<div grid="~ cols-2 gap-4">
<div>

```tsx
// src/utils/dateFormatter.ts
export const formatRelativeTime = (date: string): string => {
  const now = new Date();
  const messageDate = new Date(date);
  const diffMs = now.getTime() - messageDate.getTime();
  const diffMins = Math.floor(diffMs / 60000);

  if (diffMins < 1) return 'ãŸã£ãŸä»Š';
  if (diffMins < 60) return `${diffMins}åˆ†å‰`;

  const diffHours = Math.floor(diffMins / 60);
  if (diffHours < 24) return `${diffHours}æ™‚é–“å‰`;

  const diffDays = Math.floor(diffHours / 24);
  if (diffDays < 7) return `${diffDays}æ—¥å‰`;

  return messageDate.toLocaleDateString('ja-JP');
};
```

</div>
<div>

```diff
// src/components/MessageItem.tsx
+ import { formatRelativeTime } from '../utils/dateFormatter';
  import type { Message } from '../types';

  type MessageItemProps = {
    message: Message;
    onDeleteMessage: (id: string) => void;
  };

  export const MessageItem = ({ message, onDeleteMessage }: MessageItemProps) => {
-   const formatRelativeTime = (date: string): string => {
-     // çœç•¥
-   };
```

</div>
</div>

---

# 2. Props Drilling ã®å•é¡Œã¨è§£æ±ºç­–

## 2.1 Props Drilling ã¨ã¯ä½•ã‹

ç¾åœ¨ã®è¨­è¨ˆã§ã¯ï¼Œprops ã‚’è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµŒç”±ã—ã¦æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼

<div grid="~ cols-2 gap-4">
<div>

```
App (çŠ¶æ…‹ç®¡ç†)
â”œâ”€â”€ MessageForm
â”‚   â””â”€â”€ ImageUploader  â† colors ãªã©
â””â”€â”€ MessageList
    â””â”€â”€ MessageItem    â† onDeleteMessage, onStartEdit ãªã©
```

**å•é¡Œï¼š**
- MessageList ã¯ `onDeleteMessage, onStartEdit` ç­‰ã‚’ä½¿ã‚ãªã„ã®ã«å—ã‘å–ã£ã¦ MessageItem ã«æ¸¡ã™
- ã“ã‚Œã‚’ **Props Drilling**ï¼ˆãƒã‚±ãƒ„ãƒªãƒ¬ãƒ¼ï¼‰ã¨å‘¼ã¶

</div>
<div>

```tsx
// MessageList.tsx
export const MessageList = ({
  messages,
  onDeleteMessage,  // â† ä½¿ã‚ãªã„ã‘ã©å—ã‘å–ã‚‹
  onStartEdit,      // â† ä½¿ã‚ãªã„ã‘ã©å—ã‘å–ã‚‹
  // ...
}: MessageListProps) => {
  return (
    <Stack>
      {messages.map((message) => (
        <MessageItem
          message={message}
          onDeleteMessage={onDeleteMessage}  // â† æ¸¡ã™ã ã‘
          onStartEdit={onStartEdit}          // â† æ¸¡ã™ã ã‘
        />
      ))}
    </Stack>
  );
};
```

ğŸ“ **å•é¡Œç‚¹ï¼š**
- ä¸­é–“ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä¸è¦ãª props ã‚’ç®¡ç†
- props ã®å¤‰æ›´ãŒè¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«å½±éŸ¿

</div>
</div>

---

## 2.2 ï¼“ã¤ã®è§£æ±ºç­–ã®æ¯”è¼ƒ

<div grid="~ cols-2 gap-4">
<div>

#### âŒ è§£æ±ºç­– A: useContext

```tsx
const ChatContext = createContext<ChatContextType>(null);

// MessageItem.tsx
const { onDeleteMessage } = useChatContext();
```

- ãƒ¡ãƒªãƒƒãƒˆ: ä½•éšå±¤ã§ã‚‚ã‚¹ã‚­ãƒƒãƒ—ã§ãã‚‹
- ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œï¼ˆå…¨ä½“ãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰ï¼Œæš—é»™çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
- **è©•ä¾¡**: 2éšå±¤ç¨‹åº¦ã«ã¯éå‰°

<br />

#### âŒ è§£æ±ºç­– B: çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

```tsx
const useChatStore = create((set) => ({ /* ... */ }));
```

- ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ: å­¦ç¿’ã‚³ã‚¹ãƒˆãŒé«˜ã„ï¼Œå°è¦æ¨¡ã‚¢ãƒ—ãƒªã«ã¯éå‰°
- **è©•ä¾¡**: ã“ã®ã‚¢ãƒ—ãƒªã«ã¯ä¸è¦

</div>
<div>

#### âœ… è§£æ±ºç­– C: Component Compositionï¼ˆæ¨å¥¨ï¼‰

```tsx
// App.tsx ã§ MessageItem ã‚’ç”Ÿæˆ
const messageItems = messages.map((message) => (
  <MessageItem
    message={message}
    colors={colors}
    onDeleteMessage={handleDeleteMessage}
  />
));

// MessageList ã¯ children ã‚’å—ã‘å–ã‚‹ã ã‘
<MessageList>
  {messageItems}
</MessageList>
```

- ãƒ¡ãƒªãƒƒãƒˆ: ã‚·ãƒ³ãƒ—ãƒ«ã§æ˜ç¤ºçš„ï¼ŒReact å…¬å¼æ¨å¥¨ã®æ–¹æ³•ï¼Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œãªã—
- **è©•ä¾¡**: æœ€ã‚‚é©åˆ‡ãªè§£æ±ºç­–

</div>
</div>

---

## 2.3 Component Composition ã®å®Ÿè£…

MessageList ã‚’ Component Composition ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¤‰æ›´ã—ã¾ã™

<div grid="~ cols-2 gap-4">
<div>

```diff
+ import { Children } from 'react';
  import type { ReactNode } from 'react';
  import { Stack, Paper, Typography } from '@mui/material';

  type MessageListProps = {
-   messages: Message[];
-   colors: Colors;
-   onDeleteMessage: (id: string) => void;
+   children: ReactNode;
  };

- export const MessageList = ({
-   messages,
-   colors,
-   onDeleteMessage,
+   children,
  }: MessageListProps) => {
+   const count = Children.count(children);
```

</div>
<div>

```diff
+
+   if (count === 0) {
+     return (
+       <Paper
+         elevation={1}
+         sx={{/* ... */}}
+       >
+         <Typography variant="h6" color="text.secondary" sx={{ mb: 1 }}>
+           ğŸ“ ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“
+         </Typography>
+         <Typography variant="body2" color="text.secondary">
+           ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼
+         </Typography>
+       </Paper>
+     );
+   }
ï¼ˆç¶šãï¼‰
```

</div>
</div>

---

## 2.3 Component Composition ã®å®Ÿè£…ï¼ˆç¶šãï¼‰

<div grid="~ cols-2 gap-4">
<div>

```diff
ï¼ˆç¶šãï¼‰
  return (
    <Stack spacing={{ xs: 2, sm: 3 }}>
-     {messages.length === 0 ? (
-       <Paper
-         elevation={1}
-         sx={{/** ... */}}
-       >
-         <Typography variant="h6" color="text.secondary" sx={{ mb: 1 }}>
-           ğŸ“ ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“
-         </Typography>
-         <Typography variant="body2" color="text.secondary">
-           ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼
-         </Typography>
-       </Paper>
-      ) : (
-        <>
-          <Typographyã€€/** ... */ >
-            {messages.length} ä»¶ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
-          </Typography>
-          {messages.map((message: Message) => (
-            ï¼ˆçœç•¥ï¼‰
-          ))}
-        </>
```

</div>
<div>

```diff
+       {count > 0 && (
+         <Typography
+           variant="subtitle2"
+           color="text.secondary"
+           sx={{ textAlign: 'center' }}
+         >
+           {count} ä»¶ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
+         </Typography>
+       )}
+       {children}
+     </Stack>
+   );
  };
```

</div>
</div>

---

## 2.4 Component Composition ã®å…¨ä½“åƒ

App.tsx ã§ MessageItem ã‚’ç”Ÿæˆã—ã¦ MessageList ã«æ¸¡ã—ã¾ã™ï¼š

<div grid="~ cols-2 gap-4">
<div>

```diff
+ import { MessageItem } from './components/MessageItem';

    {/* â†“ App ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® return æ–‡ã®å‰è¾ºã‚Š */}
+   const messageItems = messages.map((message) => (
+     <div key={message.id}>
+       <MessageItem
+         message={message}
+         colors={colors}
+         onDeleteMessage={handleDeleteMessage}
+       />
+     </div>
+   ));
```

</div>
<div>

```diff
    return (
      <Container>
        <Paper>/* ... */</Paper>
        <MessageForm /* ... */ />
-       <MessageList
-         messages={messages}
-         colors={colors}
-         onDeleteMessage={handleDeleteMessage}
-       />
+       <MessageList>{messageItems}</MessageList>
      </Container>
    );
  };
```

</div>
</div>

---

# 3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†æ©Ÿèƒ½

## 3.1 App.tsx ã§ã®ç·¨é›†çŠ¶æ…‹ç®¡ç†

å‰Šé™¤ã ã‘ã§ãªãï¼Œç·¨é›†æ©Ÿèƒ½ã‚‚è¿½åŠ ã—ã¾ã—ã‚‡ã†ï¼ã¾ãšã¯App.tsx ã§ç·¨é›†çŠ¶æ…‹ã‚’ä¸€å…ƒç®¡ç†ã—ã¾ã™ï¼š

<div grid="~ cols-2 gap-4">
<div>

```diff
// src/App.tsx
  export const App = () => {
    const [messages, setMessages] = useState<Message[]>([]);
    const [text, setText] = useState('');
    const [image, setImage] = useState<File | null>(null);
    const [isPosting, setIsPosting] = useState<boolean>(false);
    const [isLoading, setIsLoading] = useState<boolean>(false);
+   const [editingId, setEditingId] = useState<string | null>(null);
+   const [editingText, setEditingText] = useState<string>('');
```

</div>
<div>

```diff
    // ç·¨é›†é–‹å§‹ãƒãƒ³ãƒ‰ãƒ©
+   const handleStartEdit = useCallback((id: string, currentText: string) => {
+     setEditingId(id);
+     setEditingText(currentText);
+   }, []);

    // ç·¨é›†ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒãƒ³ãƒ‰ãƒ©
+   const handleCancelEdit = useCallback(() => {
+     setEditingId(null);
+     setEditingText('');
+   }, []);
```

</div>
</div>

---

## 3.2 App.tsx ã§ã®ç·¨é›†çŠ¶æ…‹ç®¡ç†ï¼ˆç¶šãï¼‰

<div grid="~ cols-2 gap-4">
<div>

```diff
    // ç·¨é›†ä¿å­˜ãƒãƒ³ãƒ‰ãƒ©
+   const handleSaveEdit = useCallback(async () => {
+     if (!editingId || !editingText.trim()) return;
+
+     setIsPosting(true)
+
+     try {
+       await db.messages.update(editingId, {
+         text: editingText,
+         updatedAt: new Date()
+       });
+
+       setMessages(prev => prev.map(msg =>
+         msg.id === editingId
+           ? { ...msg, text: editingText, updatedAt: new Date() }
+           : msg
+       ));
+       setEditingId(null);
+       setEditingText('');
+     } catch (error) {
+       alert('ç·¨é›†ã«å¤±æ•—ã—ã¾ã—ãŸ');
+     } finally {
+       setIsPosting(false)
+     }
+   }, [editingId, editingText]);
```

</div>
<div>


æ–°ã—ã `updatedAt` ã¨ã„ã†ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ï¼Œæ–°è¦æŠ•ç¨¿æ™‚ã«ã‚‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«è¿½åŠ 

```diff
// handlePost ãƒ¡ã‚½ãƒƒãƒ‰å†…
  const newMessage: Message = {
    id: uuidv4(),
    (ä¸­ç•¥)
    createdAt,
+   updatedAt: createdAt,
  };
```

å‹ã‚‚è¿½åŠ 

```diff
// types.ts
  export type Message = {
    id: string;
    (ä¸­ç•¥)
    createdAt?: Date;
+   updatedAt?: Date;
  };
```

</div>
</div>

---

## 3.3 MessageItem ã§ã®ç·¨é›† UI å®Ÿè£…

MessageItem ã¯ç·¨é›†çŠ¶æ…‹ã‚’ props ã§å—ã‘å–ã‚‹ã®ã¿ï¼š

<div grid="~ cols-2 gap-4">
<div>

**importã®è¿½åŠ **

```diff
// MessageItem.tsx
    CardActions,
    Chip,
    Divider,
+   IconButton,
+   TextField,
    Typography,
  } from '@mui/material';
- import { Delete as DeleteIcon } from '@mui/icons-material';
+ import {
+   Delete as DeleteIcon,
+   Edit as EditIcon,
+   Check as CheckIcon,
+   Cancel as CancelIcon,
+ } from '@mui/icons-material';
```


</div>
<div>

**typeã®è¿½åŠ **

```diff
  type MessageItemProps = {
    message: Message;
    colors: Colors;
+   isEditing: boolean;
+   editingText: string;
+   onEditTextChange: (text: string) => void;
+   onStartEdit: (id: string, text: string) => void;
+   onSaveEdit: () => void;
+   onCancelEdit: () => void;
    onDeleteMessage: (id: string) => void;
  };
```

</div>
</div>

---

## 3.3 MessageItem ã§ã®ç·¨é›† UI å®Ÿè£…ï¼ˆç¶šãï¼‰

<div grid="~ cols-2 gap-4">
<div>

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ›´æ–°:**

```diff
  export const MessageItem = ({
    message,
    colors,
+   isEditing,
+   editingText,
+   onEditTextChange,
+   onStartEdit,
+   onSaveEdit,
+   onCancelEdit,
    onDeleteMessage
  }: MessageItemProps) => {
```

</div>
<div>

**ç·¨é›†ãƒ»å‰Šé™¤ãƒœã‚¿ãƒ³:**

```diff
  <CardActions sx={{ justifyContent: 'flex-end', p: { xs: 1.5, sm: 2 } }}>
+   {!isEditing && (
+     <Button
+       size="small"
+       color="primary"
+       startIcon={<EditIcon />}
+       onClick={() => onStartEdit(message.id, message.text)}
+       sx={{
+         borderRadius: 2,
+         fontSize: { xs: '0.8rem', sm: '0.875rem' },
+       }}
+     >
+       ç·¨é›†
+     </Button>
+   )}
    <Button /* ... */>
      å‰Šé™¤
    </Button>
  </CardActions>
```

</div>
</div>

---

## 3.4 ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã® UI å®Ÿè£…

<div grid="~ cols-2 gap-4">
<div>

**ä¿å­˜ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³:**

```diff
      <CardContent>
        {/** ç·¨é›†ä¸­ã®ä¿å­˜ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ */}
+       {isEditing && (
+         <Box sx={{ display: 'flex', gap: 1, mb: 1 }}>
+           <IconButton onClick={onSaveEdit} size="small" color="primary">
+             <CheckIcon />
+           </IconButton>
+           <IconButton onClick={onCancelEdit} size="small">
+             <CancelIcon />
+           </IconButton>
+         </Box>
+       )}
```

</div>
<div>

**ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºãƒ»ç·¨é›†:**

```diff
-       <Typography variant="body1" component="p" sx={{/* ... */}}>
-         {message.text}
-       </Typography>

        {/* ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º or ç·¨é›†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */}
+       {isEditing ? (
+         <TextField
+           fullWidth
+           multiline
+           minRows={2}
+           value={editingText}
+           onChange={(e) => onEditTextChange(e.target.value)}
+           autoFocus
+         />
+       ) : (
+         <Typography variant="body1" component="p" sx={{/* ... */}}>
+           {message.text}
+         </Typography>
+       )}
```

</div>
</div>

---

## 3.4 ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã® UI å®Ÿè£…ï¼ˆç¶šãï¼‰

**ç·¨é›†ãƒãƒ¼ã‚¯:**

```diff
  {isEditing ? (
    /* ... */
  ) : (
    <Tyopgraphy /* ... */ />
      {message.text}
+     <Typography variant="caption" sx={{ color: 'gray' }}>
+       {message.updatedAt &&
+.        message.updatedAt !== message.createdAt &&
+         'ï¼ˆç·¨é›†æ¸ˆã¿ï¼‰'}
+     </Typography>
    </Typography>
  )}
```

ä»Šå›ã¯ Slack ã® UI ã‚’è¸è¥²ã—ã¾ã—ãŸ

---

## 3.5 App.tsx ã§ã® MessageItem ä½¿ç”¨

<div grid="~ cols-2 gap-4">
<div>

MessageItem ã® props ã«è¿½åŠ 

```diff
  const messageItems = messages.map((message) => (
    <MessageItem
      key={message.id}
      message={message}
      colors={colors}
+     isEditing={editingId === message.id}
+     editingText={editingText}
+     onEditTextChange={setEditingText}
+     onStartEdit={handleStartEdit}
+     onSaveEdit={handleSaveEdit}
+     onCancelEdit={handleCancelEdit}
      onDeleteMessage={handleDeleteMessage}
    />
  ))
```

</div>
<div>

ç·¨é›†æ©Ÿèƒ½ã®ãŸã‚ã«å‹å®šç¾©ã‚’æ›´æ–°ã—ã¾ã™ï¼š

```diff
// src/types/index.ts
  export type Message = {
    id?: string;
    text: string;
    image?: string;
    imageName?: string;
    date: string;
    createdAt: Date;
+   updatedAt?: Date;
  };
```

</div>
</div>

---

# 4. æ¤œç´¢æ©Ÿèƒ½ã®è¿½åŠ 

## 4.1 æ¤œç´¢æ©Ÿèƒ½ã®å¿…è¦æ€§

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå¢—ãˆã¦ãã‚‹ã¨æ¤œç´¢æ©Ÿèƒ½ãŒå¿…è¦ã«ãªã‚Šã¾ã™ï¼š

ğŸ“ **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‹ãƒ¼ã‚ºï¼š**
- éå»ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç´ æ—©ãè¦‹ã¤ã‘ãŸã„
- ç‰¹å®šã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§çµã‚Šè¾¼ã¿ãŸã„
- æ—¥ä»˜ã§çµã‚Šè¾¼ã¿ãŸã„

ğŸ“ **å®Ÿè£…æ–¹é‡ï¼š**
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢
- å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„
- æ¤œç´¢çµæœã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ

---

## 4.2 æ¤œç´¢ UI ã®å®Ÿè£…

æ–°ã—ã `src/components/SearchBar.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™

<div grid="~ cols-2 gap-4">
<div>

```tsx
import {
  Paper,
  TextField,
  InputAdornment,
  IconButton,
} from '@mui/material';
import { Search as SearchIcon, Clear as ClearIcon } from '@mui/icons-material';
import type { Colors } from '../types';

type SearchBarProps = {
  searchText: string;
  colors: Colors;
  onSearchChange: (term: string) => void;
};

export const SearchBar = ({ searchText, colors, onSearchChange }: SearchBarProps) => {
  return (
    <Paper
      elevation={2}
      sx={{ p: 2, mb: 3, background: colors.surface, borderRadius: 2 }}
    >
```

</div>
<div>

```tsx
      <TextField
        fullWidth
        placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¤œç´¢..."
        value={searchText}
        onChange={(e) => onSearchChange(e.target.value)}
        size="small"
        sx={{
          '& .MuiOutlinedInput-root': {
            backgroundColor: colors.gradient,
            borderRadius: 2,
          },
        }}
        slotProps={{
          input: {
            startAdornment: (
              <InputAdornment position="start">
                <SearchIcon color="action" />
              </InputAdornment>
            ),
```

</div>
</div>

---

## 4.2 æ¤œç´¢ UI ã®å®Ÿè£…ï¼ˆç¶šãï¼‰

<div grid="~ cols-2 gap-4">
<div>

**ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®å®Ÿè£…:**

```tsx
            endAdornment: searchText && (
              <InputAdornment position="end">
                <IconButton
                  onClick={() => onSearchChange('')}
                  size="small"
                  sx={{
                    '&:hover': {
                      backgroundColor: 'rgba(0, 0, 0, 0.04)',
                    },
                  }}
                >
                  <ClearIcon fontSize="small" />
                </IconButton>
              </InputAdornment>
            ),
          },
        }}
      />
    </Paper>
  );
};
```

</div>
<div>

**ã‚¹ã‚¿ã‚¤ãƒ«ã®èª¬æ˜:**

- `elevation={2}`: å½±ã‚’ã¤ã‘ã¦æµ®ãä¸ŠãŒã‚‹åŠ¹æœ
- `background`: ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ï¼ˆãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼ã¨çµ±ä¸€ï¼‰
- `backgroundColor: 'white'`: å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç™½ã«
- `borderRadius: 2`: è§’ã‚’ä¸¸ãã—ã¦æŸ”ã‚‰ã‹ã„å°è±¡
- `color="action"`: æ¤œç´¢ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚°ãƒ¬ãƒ¼ã«
- `&:hover`: ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã«ãƒ›ãƒãƒ¼åŠ¹æœ

</div>
</div>

---

## 4.2 æ¤œç´¢ UI ã®å®Ÿè£…ï¼ˆApp.tsx ã§ã®ä½¿ç”¨ï¼‰

<div grid="~ cols-2 gap-4">
<div>

**çŠ¶æ…‹ç®¡ç†ã®è¿½åŠ :**

```diff
+ import { SearchBar } from './components/SearchBar';

  export const App = () => {
    const [messages, setMessages] = useState<Message[]>([]);
    // ä¸­ç•¥
    const [editingText, setEditingText] = useState('');
+   const [searchText, setSearchText] = useState('');
```

**æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é–¢æ•°ã®è¿½åŠ :**

```diff
+   const getFilteredMessages = () => {
+     if (!searchText.trim()) {
+       return messages;
+     }
+
+     return messages.filter(message =>
+       message.text.toLowerCase().includes(searchText.toLowerCase())
+     );
+   };
+
+   const filteredMessages = getFilteredMessages();
```

</div>
<div>

**SearchBar ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¿½åŠ :**

```diff
- const messageItems = messages.map((message) => (
+ const messageItems = filteredMessages.map((message) => (

  return (
    <Box sx={{ minHeight: '100vh', background: colors.gradient }}>
      <Container maxWidth="md" sx={{ py: 4 }}>
        {/* ã‚¿ã‚¤ãƒˆãƒ« */}
        <Paper>...</Paper>

        {/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒ  */}
        <MessageForm ... />

+       {/* æ¤œç´¢ãƒãƒ¼ */}
+       <SearchBar
+         searchText={searchText}
+         colors={colors}
+         onSearchChange={setSearchText}
+       />
```

</div>
</div>

ğŸ“ **æ³¨æ„:** ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã§æ¤œç´¢æ©Ÿèƒ½ã‚’å®Ÿç¾ï¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã¯å¾Œã®ç« ã§å®Ÿæ–½

---

## 4.3 æ¤œç´¢çµæœã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ

æ–°ã—ã `src/components/HighlightText.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™

<div grid="~ cols-2 gap-4">
<div>

```tsx
import { Box } from '@mui/material';

type HighlightTextProps = {
  text: string;
  searchText: string;
};

export const HighlightText = ({
  text,
  searchText
}: HighlightTextProps) => {
  // æ¤œç´¢èªå¥ãŒãªã„å ´åˆã¯ãã®ã¾ã¾è¡¨ç¤º
  if (!searchText.trim()) {
    return <>{text}</>;
  }

  // æ­£è¦è¡¨ç¾ã§æ¤œç´¢èªå¥ã‚’æŠ½å‡ºï¼ˆå¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„ï¼‰
  const regex = new RegExp(`(${searchText})`, 'gi');
  const parts = text.split(regex);
```

</div>
<div>

```tsx
  return (
    <>
      {parts.map((part, index) =>
        regex.test(part) ? (
          <Box
            key={index}
            component="span"
            sx={{
              backgroundColor: '#fff59d',
              color: '#000',
              fontWeight: 'bold',
              padding: '2px 6px',
              borderRadius: '4px',
              boxShadow: '0 1px 2px rgba(0,0,0,0.1)',
            }}
          >
            {part}
          </Box>
        ) : (
          part
        )
      )}
    </>
  );
};
```

ğŸ“ **ãƒã‚¤ãƒ©ã‚¤ãƒˆã®ãƒ‡ã‚¶ã‚¤ãƒ³:**
- `#fff59d`: é»„è‰²ã„ãƒãƒ¼ã‚«ãƒ¼ï¼ˆè¦–èªæ€§ãŒé«˜ã„ï¼‰
- `boxShadow`: è»½ã„å½±ã§ç«‹ä½“æ„Ÿã‚’æ¼”å‡º
- `fontWeight: 'bold'`: å¤ªå­—ã§å¼·èª¿

</div>
</div>

---

## 4.4 MessageItem ã§ã® HighlightText ã®ä½¿ç”¨

<div grid="~ cols-2 gap-4">
<div>

**MessageItem ã« searchText ã‚’è¿½åŠ :**

```diff
// src/components/MessageItem.tsx
+ import { HighlightText } from './HighlightText';

  type MessageItemProps = {
    message: Message;
    colors: Colors;
    isEditing: boolean;
    editingText: string;
+   searchText: string;
    onEditTextChange: (text: string) => void;

  export const MessageItem = ({
    message,
    colors,
    isEditing,
    editingText,
+   searchText,
    onEditTextChange,
    onStartEdit,
```

</div>
<div>

**ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºéƒ¨åˆ†ã®å¤‰æ›´:**

```diff
  {isEditing ? (
    <TextField /* ... */ />
  ) : (
    <Typography variant="body1" component="p" sx={{/* ... */}}>
-     {message.text}
+     <HighlightText
+       text={message.text}
+       searchText={searchText}
+     />
      <Typography variant="caption" sx={{ color: 'gray' }}>
        {message.updatedAt && 'ï¼ˆç·¨é›†æ¸ˆã¿ï¼‰'}
      </Typography>
    </Typography>
  )}
```

</div>
</div>

---

## 4.5 App.tsx ã§ MessageItem ã« searchText ã‚’æ¸¡ã™

<div grid="~ cols-2 gap-4">
<div>

**MessageItem ã« searchText ã‚’è¿½åŠ :**

```diff
// src/App.tsx
  <MessageList>
    <Typography /* ... */>
      {filteredMessages.length} ä»¶ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    </Typography>
    {filteredMessages.map((message) => (
      <MessageItem
        key={message.id}
        message={message}
        colors={colors}
        isEditing={editingId === message.id}
        editingText={editingText}
+       searchText={searchText}
        onEditTextChange={setEditingText}
        onStartEdit={handleStartEdit}
        onSaveEdit={handleSaveEdit}
        onCancelEdit={handleCancelEdit}
        onDeleteMessage={handleDeleteMessage}
      />
    ))}
  </MessageList>
```

</div>
<div>

**å‹•ä½œç¢ºèªã®ãƒã‚¤ãƒ³ãƒˆ:**

1. **æ¤œç´¢ãƒãƒ¼ã«æ–‡å­—ã‚’å…¥åŠ›**
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚Œã‚‹
   - ä»¶æ•°è¡¨ç¤ºã‚‚æ›´æ–°ã•ã‚Œã‚‹

2. **æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º**
   - é»„è‰²ã„ãƒãƒ¼ã‚«ãƒ¼ã§å¼·èª¿ã•ã‚Œã‚‹
   - å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã›ãšæ¤œç´¢ã§ãã‚‹

3. **ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã§æ¤œç´¢ã‚’ãƒªã‚»ãƒƒãƒˆ**
   - Ã—ãƒœã‚¿ãƒ³ã§æ¤œç´¢èªå¥ã‚’å‰Šé™¤
   - å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå†è¡¨ç¤ºã•ã‚Œã‚‹

</div>
</div>

---

# 5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

## 5.0 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œã®ç‰¹å®šã¨è¨ºæ–­

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå¢—ãˆã‚‹ã¨ï¼Œãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚„æ“ä½œæ™‚ã«é…å»¶ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼åŸå› ã‚’ç‰¹å®šã—ã¾ã—ã‚‡ã†ï¼

ğŸ“ **ã‚ˆãã‚ã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œï¼š**
- ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿã—ã¦ã„ã‚‹
- æ¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„é–¢æ•°ã‚’å†ç”Ÿæˆã—ã¦ã„ã‚‹
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒ¡ãƒ¢åŒ–ã•ã‚Œã¦ã„ãªã„
- é‡ã„è¨ˆç®—ãŒæ¯å›å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹

ğŸ“ **ä»Šå›ã®å•é¡Œç®‡æ‰€ï¼š**
1. **colors ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†ç”Ÿæˆ** - App.tsx:38-45
2. **filteredMessages ã®å†è¨ˆç®—** - App.tsx:199-207
3. **MessageItem ã®ãƒ¡ãƒ¢åŒ–ä¸è¶³** - å…¨ã¦ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

---

## 5.1 å•é¡Œ1: colors ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†ç”Ÿæˆ

<div grid="~ cols-2 gap-4">
<div>

**ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ï¼ˆå•é¡Œã‚ã‚Šï¼‰:**

```tsx
// App.tsx
const App = () => {
  const theme = useTheme();

  // æ¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆ
  const colors: Colors = {
    primary: theme.palette.primary.main,
    secondary: theme.palette.secondary.main,
    gradient: `linear-gradient(...)`,
    gradientHover: `linear-gradient(...)`,
    surface: theme.palette.background.paper,
    background: theme.palette.background.default,
  };

  // colors ã¯ MessageItem ã«æ¸¡ã•ã‚Œã‚‹
  return (
    <MessageItem colors={colors} />
  );
};
```

</div>
<div>

**å•é¡Œç‚¹ï¼š**
- æ¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä½œã‚‰ã‚Œã‚‹
- å‚ç…§ãŒå¤‰ã‚ã‚‹ãŸã‚ï¼ŒMessageItem ãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä¸å¿…è¦ã«å†æç”»ã•ã‚Œã‚‹

**å½±éŸ¿ï¼š**
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•° Ã— å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚³ã‚¹ãƒˆ
- 10ä»¶ãªã‚‰10å€ï¼Œ100ä»¶ãªã‚‰100å€ã®ã‚³ã‚¹ãƒˆ

**è§£æ±ºç­–ï¼š**
- `useMemo` ã§ãƒ¡ãƒ¢åŒ–ã™ã‚‹
- theme ãŒå¤‰ã‚ã‚‰ãªã„é™ã‚ŠåŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™

</div>
</div>

---

## 5.2 å•é¡Œ1ã®è§£æ±º: useMemo ã§ãƒ¡ãƒ¢åŒ–

<div grid="~ cols-2 gap-4">
<div>

**useMemo ã® import:**

```diff
// App.tsx
  import {
    useEffect,
    useState,
    useCallback,
+   useMemo,
    type ChangeEvent,
    type FormEvent,
  } from 'react';
```

</div>
<div>

**colors ã®ãƒ¡ãƒ¢åŒ–:**

```diff
  const App = () => {
    const theme = useTheme();

-   const colors: Colors = {
-     primary: theme.palette.primary.main,
-     secondary: theme.palette.secondary.main,
-     gradient: `linear-gradient(...)`,
-     gradientHover: `linear-gradient(...)`,
-     surface: theme.palette.background.paper,
-     background: theme.palette.background.default,
-   };
+   const colors: Colors = useMemo(() => ({
+     primary: theme.palette.primary.main,
+     secondary: theme.palette.secondary.main,
+     gradient: `linear-gradient(...)`,
+     gradientHover: `linear-gradient(...)`,
+     surface: theme.palette.background.paper,
+     background: theme.palette.background.default,
+   }), [theme]);
```

</div>
</div>

---

## 5.3 å•é¡Œ2: æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é–¢æ•°ã®æœ€é©åŒ–

<div grid="~ cols-2 gap-4">
<div>

**ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ï¼ˆå•é¡Œã‚ã‚Šï¼‰:**

```tsx
// App.tsx
const App = () => {
  const [messages, setMessages] = useState<Message[]>([]);
  const [searchText, setSearchText] = useState('');

  // æ¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§å†è¨ˆç®—ã•ã‚Œã‚‹
  const getFilteredMessages = () => {
    if (!searchText.trim()) {
      return messages;
    }

    return messages.filter(message =>
      message.text.toLowerCase().includes(searchText.toLowerCase())
    );
  };

  const filteredMessages = getFilteredMessages();

  return (
    <MessageList>
      {filteredMessages.map((message) => (
        <MessageItem key={message.id} message={message} />
      ))}
    </MessageList>
  );
};
```

</div>
<div>

**å•é¡Œç‚¹ï¼š**
- æ¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹
- messages ã‚„ searchText ãŒå¤‰ã‚ã‚‰ãªãã¦ã‚‚å†è¨ˆç®—
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ãŒå¤šã„ã¨å‡¦ç†ã‚³ã‚¹ãƒˆãŒé«˜ã„

**å½±éŸ¿ï¼š**
- 100ä»¶ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§æ¯å›100å›ã®ãƒ«ãƒ¼ãƒ—å‡¦ç†
- ä¸è¦ãªæ–‡å­—åˆ—æ¯”è¼ƒãŒç™ºç”Ÿ
- UIã®åå¿œãŒé…ããªã‚‹

**è§£æ±ºç­–ï¼š**
- `useMemo` ã§ãƒ¡ãƒ¢åŒ–ã™ã‚‹
- messages ã¨ searchText ãŒå¤‰ã‚ã£ãŸæ™‚ã®ã¿å†è¨ˆç®—

</div>
</div>

---

## 5.4 å•é¡Œ2ã®è§£æ±º: useMemo ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‡¦ç†ã‚’ãƒ¡ãƒ¢åŒ–

<div grid="~ cols-2 gap-4">
<div>

**é–¢æ•°ã‚’å‰Šé™¤ã—ã¦ useMemo ã«å¤‰æ›´:**

```diff
// App.tsx
  const App = () => {
    const [messages, setMessages] = useState<Message[]>([]);
    const [searchText, setSearchText] = useState('');

-   const getFilteredMessages = () => {
-     if (!searchText.trim()) {
-       return messages;
-     }
-
-     return messages.filter(message =>
-       message.text.toLowerCase().includes(searchText.toLowerCase())
-     );
-   };
-
-   const filteredMessages = getFilteredMessages();
```

</div>
<div>

**useMemo ã§æœ€é©åŒ–:**

```diff
+   const filteredMessages = useMemo(() => {
+     if (!searchText.trim()) {
+       return messages;
+     }
+
+     return messages.filter(message =>
+       message.text.toLowerCase().includes(searchText.toLowerCase())
+     );
+   }, [messages, searchText]);

    return (
      <MessageList>
        {filteredMessages.map((message) => (
          <MessageItem key={message.id} message={message} />
        ))}
      </MessageList>
    );
  };
```

ğŸ“ **åŠ¹æœ:** messages ã‚„ searchText ãŒå¤‰ã‚ã‚‰ãªã„é™ã‚Šï¼Œå‰å›ã®çµæœã‚’å†åˆ©ç”¨

</div>
</div>

---

## 5.5 å•é¡Œ3: messageItems ã®å†è¨ˆç®—

<div grid="~ cols-2 gap-4">
<div>

**ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ï¼ˆå•é¡Œã‚ã‚Šï¼‰:**

```tsx
// App.tsx
const App = () => {
  const [messages, setMessages] = useState<Message[]>([]);
  // ...ä»–ã® state

  // æ¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ .map() ãŒå®Ÿè¡Œã•ã‚Œã‚‹
  const messageItems = filteredMessages.map((message) => (
    <MessageItem
      key={message.id}
      message={message}
      colors={colors}
      isEditing={editingId === message.id}
      editingText={editingText}
      searchText={searchText}
      onEditTextChange={setEditingText}
      onStartEdit={handleStartEdit}
      onSaveEdit={handleSaveEdit}
      onCancelEdit={handleCancelEdit}
      onDeleteMessage={handleDeleteMessage}
    />
  ));

  return (
    <MessageList>{messageItems}</MessageList>
  );
};
```

</div>
<div>

**å•é¡Œç‚¹ï¼š**
- æ¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ `.map()` ãŒå®Ÿè¡Œã•ã‚Œã‚‹
- é–¢ä¿‚ãªã„ state ã®æ›´æ–°ã§ã‚‚å…¨ã¦å†è¨ˆç®—
- JSX é…åˆ—ãŒæ¯å›å†ç”Ÿæˆã•ã‚Œã‚‹

**å½±éŸ¿ï¼š**
- text å…¥åŠ›ã®ãŸã³ã«å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å†è¨ˆç®—
- ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚³ã‚¹ãƒˆãŒå¢—åŠ 

**è§£æ±ºç­–ï¼š**
- `useMemo` ã§ãƒ¡ãƒ¢åŒ–
- ä¾å­˜ã™ã‚‹å€¤ãŒå¤‰ã‚ã£ãŸæ™‚ã®ã¿å†è¨ˆç®—

</div>
</div>

---

## 5.6 å•é¡Œ3ã®è§£æ±º: useMemo ã§ messageItems ã‚’ãƒ¡ãƒ¢åŒ–

<div grid="~ cols-2 gap-4">
<div>

**useMemo ã§ãƒ¡ãƒ¢åŒ–:**

```diff
// App.tsx
+ const messageItems = useMemo(
+   () =>
+     filteredMessages.map((message) => (
+       <MessageItem
+         key={message.id}
+         message={message}
+         colors={colors}
         ï¼ˆçœç•¥ï¼‰
+         onCancelEdit={handleCancelEdit}
+         onDeleteMessage={handleDeleteMessage}
+       />
+     )),
+   [
+     filteredMessages,
+     colors,
+     editingId,
+     editingText,
+     searchText,
+   ],
+ );
```

</div>
<div>

**åŠ¹æœã¨æ³¨æ„ç‚¹ï¼š**

ğŸ“ **åŠ¹æœ:**
- ä¾å­˜ã™ã‚‹å€¤ãŒå¤‰ã‚ã‚‰ãªã„é™ã‚Šå†è¨ˆç®—ã‚’ã‚¹ã‚­ãƒƒãƒ—
- text å…¥åŠ›æ™‚ã®ä¸è¦ãªå†è¨ˆç®—ã‚’é˜²æ­¢

ğŸ“ **æ³¨æ„ç‚¹:**
- ä¾å­˜é…åˆ—ã«å«ã‚ã‚‹å€¤ãŒå¤šã„ã¨åŠ¹æœãŒé™å®šçš„
- MessageItem è‡ªä½“ã®ãƒ¡ãƒ¢åŒ–ã¨çµ„ã¿åˆã‚ã›ã‚‹ã¨åŠ¹æœå¤§

ğŸ“ **æ¨å¥¨ï¼š**
- MessageItem ã‚’ `React.memo` ã§ãƒ©ãƒƒãƒ—ï¼ˆæ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
- ã“ã‚Œã«ã‚ˆã‚Šå€‹ã€…ã®ã‚¢ã‚¤ãƒ†ãƒ ã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚‚é˜²æ­¢

</div>
</div>

---

## 5.7 å•é¡Œ4: MessageItem ã®ãƒ¡ãƒ¢åŒ–ä¸è¶³

<div grid="~ cols-2 gap-4">
<div>

**ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ï¼ˆå•é¡Œã‚ã‚Šï¼‰:**

```tsx
// MessageItem.tsx
export const MessageItem = ({
  message,
  colors,
  ï¼ˆçœç•¥ï¼‰
  onCancelEdit,
  onDeleteMessage
}: MessageItemProps) => {
  return (
    <Card>
      {/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º */}
    </Card>
  );
};
```

**å•é¡Œç‚¹ï¼š**
- MessageItem ãŒãƒ¡ãƒ¢åŒ–ã•ã‚Œã¦ã„ãªã„
- è¦ªã® state ãŒå¤‰ã‚ã‚‹ã¨å…¨ã¦ãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- 1ã¤ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç·¨é›†â†’å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå†æç”»

</div>
<div>

**è§£æ±ºç­–: React.memo ã§ãƒ©ãƒƒãƒ—:**

```diff
+ import { memo } from 'react';

  type MessageItemProps = {
    message: Message;
    colors: Colors;
    isEditing: boolean;
    editingText: string;
    searchText: string;
    // ...ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
  };

- export const MessageItem = ({
+ const MessageItemComponent = ({
    message,
    colors,
+   isEditing,
+   editingText,
+   searchText,
    // ...
  }: MessageItemProps) => {
    return (
      <Card>
        {/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º */}
      </Card>
    );
  };

+ export const MessageItem = memo(MessageItemComponent);
```

</div>
</div>

---

## 5.8 é«˜åº¦ãªæœ€é©åŒ–: ã‚«ã‚¹ã‚¿ãƒ æ¯”è¼ƒé–¢æ•°

React.memo ã«ã‚«ã‚¹ã‚¿ãƒ æ¯”è¼ƒé–¢æ•°ã‚’æ¸¡ã™ã“ã¨ã§ï¼Œã•ã‚‰ã«ç´°ã‹ã„åˆ¶å¾¡ãŒå¯èƒ½ã§ã™ï¼š

<div grid="~ cols-2 gap-4">
<div>

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® React.memo:**

```tsx
// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯æµ…ã„æ¯”è¼ƒï¼ˆshallow comparisonï¼‰
export const MessageItem = memo(MessageItemComponent);

// props ã®ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æ¯”è¼ƒ
// ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„é…åˆ—ã¯å‚ç…§ãŒå¤‰ã‚ã‚‹ã¨å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
```

**å•é¡Œï¼š**
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­èº«ãŒåŒã˜ã§ã‚‚å‚ç…§ãŒå¤‰ã‚ã‚‹ã¨å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- ä¸è¦ãªæ¯”è¼ƒå‡¦ç†ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§

</div>
<div>

**ã‚«ã‚¹ã‚¿ãƒ æ¯”è¼ƒé–¢æ•°:**

```tsx
export const MessageItem = memo(
  MessageItemComponent,
  (prevProps, nextProps) => {
    // true ã‚’è¿”ã™ã¨å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ã‚¹ã‚­ãƒƒãƒ—
    // false ã‚’è¿”ã™ã¨å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    return (
      prevProps.message.id === nextProps.message.id &&
      prevProps.message.text === nextProps.message.text &&
      prevProps.message.updatedAt === nextProps.message.updatedAt &&
      prevProps.isEditing === nextProps.isEditing &&
      prevProps.searchText === nextProps.searchText
    );
  }
);
```

ğŸ“ **ä½¿ç”¨å ´é¢ï¼š** props ãŒè¤‡é›‘ãªå ´åˆã‚„ï¼Œç‰¹å®šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã¿ç›£è¦–ã—ãŸã„å ´åˆ

</div>
</div>

---

## 5.9 useCallback ã«ã‚ˆã‚‹é–¢æ•°ã®ãƒ¡ãƒ¢åŒ–

ç¾åœ¨ã® App.tsx ã§ã¯æ—¢ã« `useCallback` ã‚’ä½¿ã£ã¦ã„ã¾ã™ï¼š

<div grid="~ cols-2 gap-4">
<div>

```tsx
// App.tsx - æ—¢å­˜ã®ãƒãƒ³ãƒ‰ãƒ©
const handleDeleteMessage = useCallback(
  async (id: string): Promise<void> => {
    // å‰Šé™¤å‡¦ç†...
  },
  [messages],
);

const handleStartEdit = useCallback(
  (id: string, currentText: string) => {
    setEditingId(id);
    setEditingText(currentText);
  },
  [],
);

const handleSaveEdit = useCallback(async () => {
  // ç·¨é›†ä¿å­˜å‡¦ç†...
}, [editingId, editingText]);
```

</div>
<div>

ğŸ“ **ãƒã‚¤ãƒ³ãƒˆï¼š**

- `useCallback` ã§é–¢æ•°ã‚’ãƒ¡ãƒ¢åŒ–
- ä¾å­˜é…åˆ—ã«å¿…è¦ãªå€¤ã‚’å«ã‚ã‚‹
- `memo` ã§ãƒ©ãƒƒãƒ—ã—ãŸ MessageItem ã¨çµ„ã¿åˆã‚ã›ã‚‹ã¨åŠ¹æœçš„

ğŸ“ **æ³¨æ„ç‚¹ï¼š**

- ä¾å­˜é…åˆ—ãŒç©º `[]` = åˆå›ã®ã¿ç”Ÿæˆ
- ä¾å­˜é…åˆ—ã«å€¤ãŒã‚ã‚‹ = ãã®å€¤ãŒå¤‰ã‚ã‚‹ã¨å†ç”Ÿæˆ
- `messages` ã«ä¾å­˜ã™ã‚‹ã¨ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ /å‰Šé™¤æ™‚ã«å†ç”Ÿæˆ

</div>
</div>

---

## 5.10 ä»®æƒ³åŒ–ã«ã‚ˆã‚‹å¤§é‡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œ

å¤šæ•°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åŠ¹ç‡çš„ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ä»®æƒ³åŒ–ï¼š

<div grid="~ cols-2 gap-4">
<div>

**react-window ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:**

```bash
npm install react-window @types/react-window
```

**VirtualizedMessageList ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:**

```tsx
// src/components/VirtualizedMessageList.tsx
import { FixedSizeList as List } from 'react-window';
import type { Message, Colors } from '../types';

type VirtualizedMessageListProps = {
  messages: Message[];
  height: number;
  itemHeight: number;
  colors: Colors;
  searchText: string;
  // ...ãã®ä»–ã® props
};
```

</div>
<div>

**renderItem ã®å®Ÿè£…:**

```tsx
export const VirtualizedMessageList = ({
  messages, height, itemHeight, colors, searchText, ...handlers
}: VirtualizedMessageListProps) => {
  const renderItem = ({ index, style }: { index: number; style: CSSProperties }) => (
    <div style={style}>
      <MessageItem
        message={messages[index]}
        colors={colors}
        searchText={searchText}
        {...handlers}
      />
    </div>
  );
```

</div>
</div>

---

## 5.11 ä»®æƒ³åŒ–ã«ã‚ˆã‚‹å¤§é‡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼ˆç¶šãï¼‰

<div grid="~ cols-2 gap-4">
<div>

**List ã®è¨­å®š:**

```tsx
  return (
    <List
      height={height}
      itemCount={messages.length}
      itemSize={itemHeight}
      itemData={messages}
    >
      {renderItem}
    </List>
  );
};
```

ğŸ“ **ä»®æƒ³åŒ–ã®åŠ¹æœï¼š**
- 1000ä»¶ä»¥ä¸Šã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã‚‚æ»‘ã‚‰ã‹ãªå‹•ä½œ
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®å‰Šæ¸›
- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Š

</div>
<div>

**ä½¿ç”¨ä¾‹:**

```tsx
// å¤§é‡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã®ã¿ä»®æƒ³åŒ–ã‚’ä½¿ç”¨
{filteredMessages.length > 100 ? (
  <VirtualizedMessageList
    messages={filteredMessages}
    height={400}
    itemHeight={120}
    colors={colors}
    searchText={searchText}
    onDeleteMessage={handleDeleteMessage}
    // ...ãã®ä»–ã®ãƒãƒ³ãƒ‰ãƒ©
  />
) : (
  <MessageList>
    {messageItems}
  </MessageList>
)}
```

</div>
</div>

---
layout: section
---

# å®Œæˆ ğŸ‰
